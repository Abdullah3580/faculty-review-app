PROJECT SCAN RESULT
===================


--------------------------------------------------
FILE: .vercel\project.json
--------------------------------------------------
{"projectId":"prj_YXIN1LuktYVWj3Zub22GhfqAouuh","orgId":"team_Hs60NtZ9JMY4unAYc7vwMtXm","projectName":"faculty-review-app"}


--------------------------------------------------
FILE: next-env.d.ts
--------------------------------------------------
/// <reference types="next" />
/// <reference types="next/image-types/global" />
import "./.next/dev/types/routes.d.ts";

// NOTE: This file should not be edited
// see https://nextjs.org/docs/app/api-reference/config/typescript for more information.



--------------------------------------------------
FILE: next.config.ts
--------------------------------------------------


import type { NextConfig } from "next";

const nextConfig: NextConfig = {
 
  reactStrictMode: true,
  
  async headers() {
    return [
      
      {
        source: "/api/:path*",
        headers: [
          { key: "Access-Control-Allow-Credentials", value: "true" },
          { key: "Access-Control-Allow-Origin", value: process.env.NEXT_PUBLIC_FRONTEND_URL || "*" }, 
          { key: "Access-Control-Allow-Methods", value: "GET,DELETE,PATCH,POST,PUT" },
          { key: "Access-Control-Allow-Headers", value: "X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version" },
        ]
      },
      
      {
        source: "/:path*",
        headers: [
          {
            key: "X-DNS-Prefetch-Control",
            value: "on",
          },
          {
            key: "Strict-Transport-Security",
            value: "max-age=63072000; includeSubDomains; preload",
          },
          {
            key: "X-Frame-Options",
            value: "SAMEORIGIN", 
          },
          {
            key: "X-Content-Type-Options",
            value: "nosniff", 
          },
          {
            key: "Referrer-Policy",
            value: "origin-when-cross-origin",
          },
        ],
      },
    ];
  },
};

export default nextConfig;


--------------------------------------------------
FILE: package.json
--------------------------------------------------
{
  "name": "faculty-review-app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "prisma:migrate": "dotenv -e .env -- npx prisma migrate dev",
    "build": "prisma generate && next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@auth/prisma-adapter": "^2.11.1",
    "@prisma/client": "^6.19.0",
    "argon2": "^0.44.0",
    "bcrypt": "^6.0.0",
    "deep-email-validator": "^0.1.21",
    "dotenv": "^17.2.3",
    "dotenv-cli": "^11.0.0",
    "framer-motion": "^12.23.25",
    "lucide-react": "^0.556.0",
    "next": "^16.0.7",
    "next-auth": "^4.24.13",
    "next-themes": "^0.4.6",
    "nodemailer": "^7.0.10",
    "react": "^19.2.1",
    "react-dom": "^19.2.1",
    "react-hot-toast": "^2.6.0",
    "react-icons": "^5.5.0",
    "recharts": "^3.5.1",
    "uuid": "^13.0.0",
    "zod": "^4.1.12"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/bcryptjs": "^2.4.6",
    "@types/node": "^20",
    "@types/nodemailer": "^7.0.4",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "@types/uuid": "^10.0.0",
    "autoprefixer": "^10.4.22",
    "babel-plugin-react-compiler": "1.0.0",
    "eslint": "^9",
    "eslint-config-next": "16.0.3",
    "postcss": "^8.5.6",
    "prisma": "^6.19.0",
    "tailwindcss": "^3.4.17",
    "typescript": "^5"
  }
}



--------------------------------------------------
FILE: prisma\schema.prisma
--------------------------------------------------
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  directUrl    = env("DIRECT_URL")
  relationMode = "foreignKeys"
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String     @id @default(cuid())
  email         String?    @unique
  emailVerified DateTime?
  image         String?
  name          String?
  nickname      String?    @unique
  semester      String?
  role          String     @default("STUDENT")
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @default(now()) @updatedAt
  password      String?
  studentId     String?    @unique
  accounts      Account[]
  answers       Answer[]
  questions     Question[]
  reports       Report[]
  reviews       Review[]
  sessions      Session[]
  votes         Vote[]
  notifications Notification[]
  followedFaculties Faculty[] @relation("UserFollows")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Faculty {
  id          String   @id @default(cuid())
  name        String
  email       String?
  department  String   @default("General")
  designation String   @default("Lecturer") 
  initial     String?  
  code        String?  
  roomNumber  String?  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  status      String   @default("PENDING")
  questions   Question[]
  reviews     Review[]
  followers   User[]   @relation("UserFollows")
}

model Review {
  id        String   @id @default(cuid())
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  facultyId String
  userId    String
  status    String   @default("PENDING")
  course    String   @default("General")
  reports   Report[]
  faculty   Faculty  @relation(fields: [facultyId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  votes     Vote[]
}

model Vote {
  id       String @id @default(cuid())
  type     String
  userId   String
  reviewId String
  review   Review @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, reviewId])
}

model Question {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  facultyId String
  userId    String
  answers   Answer[]
  faculty   Faculty  @relation(fields: [facultyId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Answer {
  id         String   @id @default(cuid())
  content    String
  createdAt  DateTime @default(now())
  questionId String
  userId     String
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Report {
  id        String   @id @default(cuid())
  reason    String
  createdAt DateTime @default(now())
  userId    String
  reviewId  String
  review    Review   @relation(fields: [reviewId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Department {
  id        String   @id @default(cuid())
  name      String   @unique
  createdAt DateTime @default(now())
}
// ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶∞‡¶ø‡¶∏‡ßá‡¶ü ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶Æ‡¶°‡ßá‡¶≤
model PasswordResetToken {
  id        String   @id @default(cuid())
  email     String
  token     String   @unique
  expires   DateTime
  createdAt DateTime @default(now())

  @@unique([email, token])
}
// ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶Æ‡¶°‡ßá‡¶≤ (‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
model Notification {
  id        String   @id @default(cuid())
  userId    String   
  type      String   
  message   String   
  link      String? 
  isRead    Boolean  @default(false) 
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}



--------------------------------------------------
FILE: prisma.config.ts
--------------------------------------------------

import "dotenv/config";
import { defineConfig, env } from "prisma/config";

export default defineConfig({
  schema: "prisma/schema.prisma",
  migrations: {
    path: "prisma/migrations",
  },
  engine: "classic",
  datasource: {
    url: env("DATABASE_URL"),
  },
});




--------------------------------------------------
FILE: src\app\admin\page.tsx
--------------------------------------------------
import prisma from "@/lib/prisma";
import AdminReviewControls from "@/components/AdminReviewControls";
import AdminFacultyControls from "@/components/AdminFacultyControls";
import AdminReportControls from "@/components/AdminReportControls";
import AdminDashboardSections from "@/components/AdminDashboardSections"; 
import { getServerSession } from "next-auth";
import { authOptions } from "../api/auth/[...nextauth]/route";
import { redirect } from "next/navigation";
import Link from "next/link";

export const dynamic = "force-dynamic";

export default async function AdminPage() {
  const session = await getServerSession(authOptions);
  // @ts-ignore
  if (!session || !session.user?.email) redirect("/");
  
  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  // @ts-ignore
  if (!user || user.role?.toUpperCase() !== "ADMIN") redirect("/");

  // 1. ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ø‡¶Ç
  const [userCount, facultyCount, reviewCount, departmentCount] = await Promise.all([
    prisma.user.count(),
    prisma.faculty.count({ where: { status: "APPROVED" } }),
    prisma.review.count({ where: { status: "APPROVED" } }),
    prisma.department.count(),
  ]);

  // 2. ‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü (‡¶ú‡¶∞‡ßÅ‡¶∞‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
  const pendingReviews = await prisma.review.findMany({
    where: { status: "PENDING" },
    orderBy: { createdAt: "desc" },
    include: { user: { select: { nickname: true, email: true } }, faculty: { select: { name: true } } },
  });

  const pendingFaculties = await prisma.faculty.findMany({
    where: { status: "PENDING" },
    orderBy: { createdAt: "desc" },
  });

  const reportedReviews = await prisma.report.findMany({
    orderBy: { createdAt: "desc" },
    include: { 
      user: { select: { nickname: true } }, 
      review: { include: { user: { select: { nickname: true } }, faculty: { select: { name: true } } } } 
    }
  });

  // 3. ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶°‡¶æ‡¶ü‡¶æ
  const allDepartments = await prisma.department.findMany({ orderBy: { name: "asc" } });
  const allStudents = await prisma.user.findMany({ orderBy: { createdAt: "desc" }, include: { reviews: true } });
  const allFaculties = await prisma.faculty.findMany({ where: { status: "APPROVED" }, orderBy: { name: "asc" }, include: { reviews: true } });

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-950 p-6 md:p-10 font-sans">
      <div className="max-w-7xl mx-auto">
        
        {/* Header */}
        <header className="flex flex-col md:flex-row justify-between items-center mb-10 pb-6 border-b border-gray-200 dark:border-gray-800 gap-4">
          <div>
            <h1 className="text-3xl md:text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-purple-600 dark:from-indigo-400 dark:to-purple-400">
              Admin Dashboard
            </h1>
            <p className="text-gray-500 dark:text-gray-400 mt-1">Manage users, reviews, and content.</p>
          </div>
          <Link href="/" className="glass-card px-5 py-2.5 rounded-lg hover:scale-105 transition font-medium text-gray-700 dark:text-gray-300">
            ‚¨Ö Back to Home
          </Link>
        </header>

        {/* Stats Cards */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
          <StatCard title="Total Students" count={userCount} icon="üë•" color="bg-blue-500" />
          <StatCard title="Active Faculties" count={facultyCount} icon="üë®‚Äçüè´" color="bg-purple-500" />
          <StatCard title="Total Reviews" count={reviewCount} icon="üìù" color="bg-green-500" />
          <StatCard title="Departments" count={departmentCount} icon="üè¢" color="bg-orange-500" />
        </div>

        {/* Urgent Actions Area */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
          {pendingReviews.length > 0 && (
             // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá 'as any' ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ‡ßü ‡¶≤‡¶æ‡¶≤ ‡¶¶‡¶æ‡¶ó ‡¶ö‡¶≤‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá
             <AdminReviewControls pendingReviews={pendingReviews as any} />
          )}
          {pendingFaculties.length > 0 && (
             <AdminFacultyControls pendingFaculties={pendingFaculties as any} />
          )}
          {reportedReviews.length > 0 && (
             <AdminReportControls reportedReviews={reportedReviews as any} />
          )}
        </div>

        {/* System Management (Collapsible Sections) */}
        <div className="pt-4 border-t border-gray-200 dark:border-gray-800">
          <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2">
            ‚öôÔ∏è System Management
          </h2>
          
          <AdminDashboardSections 
            departments={allDepartments}
            students={allStudents}
            faculties={allFaculties}
          />
        </div>

      </div>
    </div>
  );
}

// Simple Stat Card Component
function StatCard({ title, count, icon, color }: any) {
  return (
    <div className="glass-card p-6 rounded-xl hover:scale-[1.05] transition-transform duration-300 flex items-center justify-between">
      <div>
        <p className="text-gray-500 dark:text-gray-400 text-xs font-bold uppercase tracking-wider">{title}</p>
        <p className="text-3xl font-black text-gray-900 dark:text-white mt-1">{count}</p>
      </div>
      <div className={`w-12 h-12 ${color} text-white rounded-xl flex items-center justify-center text-2xl shadow-lg`}>
        {icon}
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\api\admin\department\route.ts
--------------------------------------------------
// src/app/api/admin/department/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

export async function POST(request: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) return NextResponse.json({ error: "Unauthorized" }, { status: 401 });

  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  if (!user || user.role !== "ADMIN") return NextResponse.json({ error: "Forbidden" }, { status: 403 });

  const { name } = await request.json();

  try {
    const newDept = await prisma.department.create({
      data: { name: name.toUpperCase() }, 
    });
    return NextResponse.json(newDept);
  } catch (error) {
    return NextResponse.json({ error: "Department already exists or error" }, { status: 400 });
  }
}

export async function DELETE(request: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  
  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  if (!user || user.role !== "ADMIN") return NextResponse.json({ error: "Forbidden" }, { status: 403 });

  const { id } = await request.json();

  try {
    await prisma.department.delete({ where: { id } });
    return NextResponse.json({ message: "Deleted" });
  } catch (error) {
    return NextResponse.json({ error: "Error deleting" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\admin\faculty\route.ts
--------------------------------------------------
// src/app/api/admin/faculty/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

export async function PUT(request: Request) {
  const session = await getServerSession(authOptions);
  
  if (!session || !session.user?.email) return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  if (!user || user.role !== "ADMIN") return NextResponse.json({ error: "Forbidden" }, { status: 403 });

  const { facultyId, action } = await request.json(); 
  try {
    if (action === "approve") {
      await prisma.faculty.update({
        where: { id: facultyId },
        data: { status: "APPROVED" },
      });
    } else if (action === "reject") {
      await prisma.faculty.delete({
        where: { id: facultyId },
      });
    }
    return NextResponse.json({ message: "Success" });
  } catch (error) {
    return NextResponse.json({ error: "Error updating faculty" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\admin\make-me-admin\route.ts
--------------------------------------------------
// src/app/api/admin/make-me-admin/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

export async function GET() {
  const session = await getServerSession(authOptions);
  
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Not logged in" }, { status: 401 });
  }

  await prisma.user.update({
    where: { email: session.user.email },
    data: { role: "ADMIN" },
  });

  return NextResponse.json({ message: `Success! ${session.user.email} is now an ADMIN.` });
}


--------------------------------------------------
FILE: src\app\api\admin\review\action\route.ts
--------------------------------------------------
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";

// üëá ‡¶è‡¶á ‡¶≤‡¶æ‡¶á‡¶®‡¶ü‡¶ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá (Absolute Path ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®)
import { authOptions } from "@/app/api/auth/[...nextauth]/route"; 

export async function POST(request: Request) { // ‚ö†Ô∏è ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø ‡¶ï‡¶∞‡ßÅ‡¶®: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá PUT ‡¶è‡¶∞ ‡¶¨‡¶¶‡¶≤‡ßá POST ‡¶π‡¶¨‡ßá
  try {
    const session = await getServerSession(authOptions);
    
    // ‡ßß. ‡¶≤‡¶ó‡¶á‡¶® ‡¶ö‡ßá‡¶ï
    if (!session || !session.user?.email) {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const user = await prisma.user.findUnique({ where: { email: session.user.email } });
    
    // ‡ß®. ‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ö‡ßá‡¶ï
    if (!user || user.role !== "ADMIN") {
      return NextResponse.json({ error: "Forbidden: Admins only" }, { status: 403 });
    }

    const body = await request.json();
    const { reviewId, action } = body;

    console.log("Processing Action:", action, "for Review:", reviewId);

    // ‡ß©. ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡ßü‡ßÄ ‡¶≤‡¶ú‡¶ø‡¶ï
    if (action === "approve") {
      await prisma.review.update({
        where: { id: reviewId },
        data: { status: "APPROVED" },
      });
    } 
    else if (action === "reject") {
      await prisma.review.delete({
        where: { id: reviewId },
      });
    }
    else if (action === "approve_report") {
      await prisma.review.delete({
        where: { id: reviewId },
      });
    }
    else if (action === "reject_report") {
      await prisma.report.deleteMany({
        where: { reviewId: reviewId }
      });
    }

    return NextResponse.json({ message: "Success", success: true });

  } catch (error) {
    console.error("API Error:", error);
    return NextResponse.json({ error: "Error processing request" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\admin\review\delete\route.ts
--------------------------------------------------
//src/app/api/admin/review/delete/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";

export async function DELETE(request: Request) {
  const session = await getServerSession(authOptions);

  const user = await prisma.user.findUnique({ where: { email: session?.user?.email! } });
  if (!user || user.role !== "ADMIN") {
    return NextResponse.json({ error: "Unauthorized access" }, { status: 403 });
  }

  try {
    const { reviewId, withWarning, warningReason } = await request.json();

    const review = await prisma.review.findUnique({
      where: { id: reviewId },
      include: { faculty: true } 
    });

    if (!review) {
      return NextResponse.json({ error: "Review not found" }, { status: 404 });
    }

    
    await prisma.review.delete({
      where: { id: reviewId },
    });

    if (withWarning) {
      await prisma.notification.create({
        data: {
          userId: review.userId,
          type: "SYSTEM", 
          message: `‚ö†Ô∏è Your review for ${review.faculty.name} was removed by Admin. Reason: "${warningReason || 'Violation of community guidelines'}".`,
          isRead: false,
        },
      });
    }

    return NextResponse.json({ message: "Review deleted successfully" });

  } catch (error) {
    return NextResponse.json({ error: "Failed to delete review" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\admin\review\route.ts
--------------------------------------------------
// src/app/api/admin/review/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

export async function PUT(request: Request) {
  const session = await getServerSession(authOptions);
  
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  if (!user || user.role !== "ADMIN") {
    return NextResponse.json({ error: "Forbidden: Admins only" }, { status: 403 });
  }

  const { reviewId, action } = await request.json(); 

  try {
    if (action === "approve") {
      await prisma.review.update({
        where: { id: reviewId },
        data: { status: "APPROVED" },
      });
    } 
    else if (action === "reject") {
      await prisma.review.delete({
        where: { id: reviewId },
      });
    }

    else if (action === "approve_report") {
      await prisma.review.delete({
        where: { id: reviewId },
      });
    }
    else if (action === "reject_report") {
      await prisma.report.deleteMany({
        where: { reviewId: reviewId }
      });
    }

    return NextResponse.json({ message: "Success" });
  } catch (error) {
    console.error(error);
    return NextResponse.json({ error: "Error updating review" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\admin\user\route.ts
--------------------------------------------------
// src/app/api/admin/user/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

export async function DELETE(request: Request) {
  const session = await getServerSession(authOptions);
  
  if (!session || !session.user?.email) return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  if (!user || user.role !== "ADMIN") return NextResponse.json({ error: "Forbidden" }, { status: 403 });

  const { userId } = await request.json();

  try {
    await prisma.user.delete({
      where: { id: userId },
    });
    return NextResponse.json({ message: "User deleted successfully" });
  } catch (error) {
    return NextResponse.json({ error: "Error deleting user" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\auth\forgot-password\route.ts
--------------------------------------------------
//src/app/api/auth/forgot-password/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { v4 as uuidv4 } from "uuid";
import { sendPasswordResetEmail } from "@/lib/email";

export async function POST(request: Request) {
  try {
    const { email } = await request.json();

    const user = await prisma.user.findUnique({ where: { email } });

    if (!user) {
      return NextResponse.json({ message: "If an account exists, a reset email has been sent." });
    }

    const token = uuidv4();
    const expires = new Date(Date.now() + 3600 * 1000);

    await prisma.passwordResetToken.deleteMany({ where: { email } });

    await prisma.passwordResetToken.create({
      data: {
        email,
        token,
        expires,
      },
    });

    
    await sendPasswordResetEmail(email, token);

    return NextResponse.json({ message: "Email sent!" });
  } catch (error) {
    console.error("Forgot Password Error:", error);
    return NextResponse.json({ error: "Something went wrong" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\auth\reset-password\route.ts
--------------------------------------------------
//src/app/api/auth/reset-password/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import argon2 from "argon2";

export async function POST(request: Request) {
  try {
    const { token, newPassword } = await request.json();

    
    const existingToken = await prisma.passwordResetToken.findUnique({
      where: { token },
    });

    if (!existingToken) {
      return NextResponse.json({ error: "Invalid or expired token" }, { status: 400 });
    }

    
    if (new Date() > existingToken.expires) {
      return NextResponse.json({ error: "Token expired" }, { status: 400 });
    }

    
    const strongPasswordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[\W_]).{8,}$/;

    if (!strongPasswordRegex.test(newPassword)) {
        return NextResponse.json({ 
            error: "Password must contain: Min 8 chars, Uppercase, Lowercase, Number & Special Char." 
        }, { status: 400 });
    }

  
    const hashedPassword = await argon2.hash(newPassword, {
        type: argon2.argon2id,
        memoryCost: 2 ** 16,
        timeCost: 3,
        parallelism: 1
    });

    
    await prisma.user.update({
      where: { email: existingToken.email },
      data: { password: hashedPassword },
    });

    
    await prisma.passwordResetToken.delete({ where: { id: existingToken.id } });

    return NextResponse.json({ message: "Password updated successfully" });

  } catch (error) {
    console.error("Reset Password Error:", error);
    return NextResponse.json({ error: "Something went wrong" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\auth\verify-email\route.ts
--------------------------------------------------
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";

export async function POST(request: Request) {
  try {
    const { token } = await request.json();

    
    const existingToken = await prisma.verificationToken.findUnique({
      where: { token },
    });

    if (!existingToken) {
      return NextResponse.json({ error: "Invalid or expired token" }, { status: 400 });
    }

    
    if (new Date() > existingToken.expires) {
      return NextResponse.json({ error: "Token expired" }, { status: 400 });
    }

    
    const existingUser = await prisma.user.findUnique({
      where: { email: existingToken.identifier },
    });

    if (!existingUser) {
      return NextResponse.json({ error: "User not found" }, { status: 404 });
    }

    await prisma.user.update({
      where: { id: existingUser.id },
      data: { 
        emailVerified: new Date(),
      },
    });

    
    await prisma.verificationToken.delete({
      where: { token },
    });

    return NextResponse.json({ message: "Email verified successfully" });

  } catch (error) {
    console.error(error);
    return NextResponse.json({ error: "Internal Server Error" }, { status: 500 });
  }
}



--------------------------------------------------
FILE: src\app\api\auth\[...nextauth]\route.ts
--------------------------------------------------
// src/app/api/auth/[...nextauth]/route.ts

import NextAuth, { NextAuthOptions } from "next-auth";
import { PrismaAdapter } from "@auth/prisma-adapter";
import prisma from "@/lib/prisma";
import CredentialsProvider from "next-auth/providers/credentials";
import argon2 from "argon2";

export const authOptions: NextAuthOptions = {
  adapter: PrismaAdapter(prisma),
  session: { strategy: "jwt" },

  providers: [
    CredentialsProvider({
      name: "Credentials",
      credentials: {
        email: { label: "Email or ID", type: "text" },
        password: { label: "Password", type: "password" },
      },

      async authorize(credentials) {
        const email = credentials?.email;
        const password = credentials?.password;

        if (!email || !password) {
          throw new Error("Please enter Email and Password");
        }

        const user = await prisma.user.findFirst({
          where: {
            OR: [{ email }, { studentId: email }],
          },
        });

        if (!user) throw new Error("User not found");
        if (!user.password) throw new Error("Please reset your password");

        if (!user.emailVerified) {
          throw new Error("Please verify your email first! Check your inbox.");
        }

        const isValid = await argon2.verify(user.password, password);
        if (!isValid) throw new Error("Invalid password");

        return user;
      },
    }),
  ],

  callbacks: {
    async jwt({ token, user }) {
      if (user) {
        token.id = user.id;
        token.role = user.role;
        token.nickname = user.nickname;
        // @ts-ignore
        token.studentId = user.studentId;
      }
      return token;
    },

    async session({ session, token }) {
      if (token && token.id) {
        const dbUser = await prisma.user.findUnique({
          where: { id: token.id as string },
        });

        if (!dbUser) {
          // @ts-ignore
          session.error = "UserDeleted";
          return session;
        }

        if (session.user) {
          session.user.id = dbUser.id;
          session.user.role = dbUser.role;
          session.user.nickname = dbUser.nickname;
          // @ts-ignore
          session.user.studentId = dbUser.studentId;
        }
      }
      return session;
    },
  },

  pages: {
    signIn: "/login",
    error: "/auth-error",
  },

  debug: process.env.NODE_ENV === "development",
};

const handler = NextAuth(authOptions);
export { handler as GET, handler as POST };


--------------------------------------------------
FILE: src\app\api\department\route.ts
--------------------------------------------------


import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";


export async function GET() {
  try {
    const departments = await prisma.department.findMany({
      orderBy: {
        name: "asc", 
      },
    });
    return NextResponse.json(departments);
  } catch (error) {
    return NextResponse.json({ error: "Failed to fetch departments" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\departments\route.ts
--------------------------------------------------


import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";


export async function GET() {
  try {
    const departments = await prisma.department.findMany({
      orderBy: {
        name: "asc", 
      },
    });
    return NextResponse.json(departments);
  } catch (error) {
    return NextResponse.json({ error: "Failed to fetch departments" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\faculty\bulk\route.ts
--------------------------------------------------
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

// ‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶Ö‡¶®‡ßá‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ API
export async function PATCH(req: Request) {
  const session = await getServerSession(authOptions);
  // @ts-ignore
  if (session?.user?.role?.toUpperCase() !== "ADMIN") {
    return new NextResponse("Unauthorized", { status: 401 });
  }

  try {
    const { ids, data } = await req.json();
    
    if (!ids.length) return new NextResponse("No IDs selected", { status: 400 });

    const result = await prisma.faculty.updateMany({
      where: { id: { in: ids } },
      data: data,
    });

    return NextResponse.json({ count: result.count });
  } catch (error) {
    return new NextResponse("Error", { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\faculty\follow\route.ts
--------------------------------------------------
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";

export async function POST(request: Request) {
  const session = await getServerSession(authOptions);
  
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const { facultyId } = await request.json();
  const user = await prisma.user.findUnique({ where: { email: session.user.email } });

  if (!user) return NextResponse.json({ error: "User not found" }, { status: 404 });

  
  const existingFollow = await prisma.user.findFirst({
    where: {
      id: user.id,
      followedFaculties: {
        some: { id: facultyId }
      }
    }
  });

  if (existingFollow) {
    
    await prisma.user.update({
      where: { id: user.id },
      data: {
        followedFaculties: {
          disconnect: { id: facultyId }
        }
      }
    });
    return NextResponse.json({ message: "Unfollowed", isFollowing: false });
  } else {
    
    await prisma.user.update({
      where: { id: user.id },
      data: {
        followedFaculties: {
          connect: { id: facultyId }
        }
      }
    });
    return NextResponse.json({ message: "Followed", isFollowing: true });
  }
}


--------------------------------------------------
FILE: src\app\api\faculty\route.ts
--------------------------------------------------
// src/app/api/faculty/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../auth/[...nextauth]/route";

export async function POST(request: Request) {
  try {
    const session = await getServerSession(authOptions);
    if (!session) {
      return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
    }

    const json = await request.json();
    
    const { name, department, designation, initial, code } = json;

    if (!name || !department) {
      return NextResponse.json({ error: "Name and Department required" }, { status: 400 });
    }

    
    const existingFaculty = await prisma.faculty.findFirst({
      where: {
        AND: [
          { name: { equals: name, mode: "insensitive" } },       
          { department: { equals: department, mode: "insensitive" } } 
        ]
      },
    });

    if (existingFaculty) {
      return NextResponse.json(
        { error: "Faculty with this name already exists in this department!" }, 
        { status: 409 } 
      );
    }
    

    const newFaculty = await prisma.faculty.create({
      data: {
        name,
        department,
        
        designation: designation || "Lecturer", 
        initial: initial || null,              
        code: code || null,                    
        status: "APPROVED",                     
      },
    });

    return NextResponse.json(newFaculty);
  } catch (error) {
    return NextResponse.json({ error: "Error creating faculty" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\faculty\[facultyId]\route.ts
--------------------------------------------------
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

// ‡¶è‡¶ï‡¶ú‡¶®‡ßá‡¶∞ ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ API
export async function PATCH(req: Request, { params }: { params: Promise<{ facultyId: string }> }) {
  const session = await getServerSession(authOptions);
  // @ts-ignore
  if (session?.user?.role?.toUpperCase() !== "ADMIN") return new NextResponse("Unauthorized", { status: 401 });

  try {
    // ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: params ‡¶è‡¶ñ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø Promise, ‡¶§‡¶æ‡¶á ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá await ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
    const { facultyId } = await params;

    const body = await req.json();
    const updatedFaculty = await prisma.faculty.update({
      where: { id: facultyId }, // params.facultyId ‡¶è‡¶∞ ‡¶¨‡¶¶‡¶≤‡ßá facultyId ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
      data: body,
    });
    return NextResponse.json(updatedFaculty);
  } catch (error) {
    return new NextResponse("Error", { status: 500 });
  }
}

// ‡¶°‡¶ø‡¶≤‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ API
export async function DELETE(req: Request, { params }: { params: Promise<{ facultyId: string }> }) {
  const session = await getServerSession(authOptions);
  // @ts-ignore
  if (session?.user?.role?.toUpperCase() !== "ADMIN") return new NextResponse("Unauthorized", { status: 401 });

  try {
    // ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: params ‡¶è‡¶ñ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø Promise, ‡¶§‡¶æ‡¶á ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá await ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá
    const { facultyId } = await params;

    await prisma.faculty.delete({ where: { id: facultyId } }); // params.facultyId ‡¶è‡¶∞ ‡¶¨‡¶¶‡¶≤‡ßá facultyId ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
    return NextResponse.json({ success: true });
  } catch (error) {
    return new NextResponse("Error", { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\forgot-password\route.ts
--------------------------------------------------

import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { v4 as uuidv4 } from "uuid";
import { sendPasswordResetEmail } from "@/lib/email";

export async function POST(request: Request) {
  console.log("üî• API Hit: /api/forgot-password"); 

  try {
    const body = await request.json();
    const { email } = body;
    console.log("üì© Email received from frontend:", email); 

    if (!email) {
      return NextResponse.json({ error: "Email is required" }, { status: 400 });
    }

    
    const user = await prisma.user.findUnique({
      where: { email },
    });
    
    console.log("üë§ User found in DB:", user ? "YES" : "NO"); 

    if (!user) {
      return NextResponse.json(
        { error: "‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡¶ü‡¶ø ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ‡¶¨‡ßá‡¶ú‡ßá ‡¶®‡ßá‡¶á‡•§" }, 
        { status: 404 }
      );
    }

    
    const token = uuidv4();
    const expires = new Date(Date.now() + 15 * 60 * 1000);

    await prisma.verificationToken.create({
      data: {
        identifier: email,
        token,
        expires,
      },
    });
    console.log("üîë Token created & saved to DB"); 

    
    console.log("üöÄ Attempting to send email...");
    await sendPasswordResetEmail(email, token);
    console.log("‚úÖ Email sent successfully!"); 

    return NextResponse.json({ message: "Reset link sent successfully!" });

  } catch (error: any) {
    
    console.error("‚ùå SERVER ERROR DETAILS:", error.message); 
    console.error(error);
    return NextResponse.json({ error: error.message || "Internal Server Error" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\notifications\route.ts
--------------------------------------------------
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../auth/[...nextauth]/route";

export async function GET() {
  const session = await getServerSession(authOptions);
  if (!session) return NextResponse.json([], { status: 401 });

  try {
    const user = await prisma.user.findUnique({ where: { email: session.user?.email! } });
    if (!user) return NextResponse.json([], { status: 404 });

    const notifications = await prisma.notification.findMany({
      where: { userId: user.id },
      orderBy: { createdAt: "desc" }, 
      take: 99, 
    });

    return NextResponse.json(notifications);
  } catch (error) {
    return NextResponse.json({ error: "Failed to fetch" }, { status: 500 });
  }
}

export async function PATCH(request: Request) {
  const session = await getServerSession(authOptions);
  if (!session) return NextResponse.json({ error: "Unauthorized" }, { status: 401 });

  try {
    const { id } = await request.json(); 
    const user = await prisma.user.findUnique({ where: { email: session.user?.email! } });

    if (id) {
      await prisma.notification.update({
        where: { id },
        data: { isRead: true },
      });
    } else {
      await prisma.notification.updateMany({
        where: { userId: user!.id, isRead: false },
        data: { isRead: true },
      });
    }

    return NextResponse.json({ success: true });
  } catch (error) {
    return NextResponse.json({ error: "Failed to update" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\qa\answer\route.ts
--------------------------------------------------
// src/app/api/qa/answer/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

export async function POST(request: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  if (!user) return NextResponse.json({ error: "User not found" }, { status: 404 });

  const { questionId, content } = await request.json();

  try {
    const newAnswer = await prisma.answer.create({
      data: {
        content,
        questionId,
        userId: user.id,
      },
    });

    const question = await prisma.question.findUnique({ where: { id: questionId } });

    if (question && question.userId !== user.id) {
      try {
        await prisma.notification.create({
          data: {
            userId: question.userId, 
            type: "REPLY",
            message: `üí¨ @${user.nickname || "Someone"} replied to your question.`,
            link: `/faculty/${question.facultyId}`,
            isRead: false,
          },
        });
      } catch (notifError) {
        console.error("Notification failed", notifError);
      }
    }

    return NextResponse.json(newAnswer);
  } catch (error) {
    return NextResponse.json({ error: "Error posting answer" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\qa\question\route.ts
--------------------------------------------------
// src/app/api/qa/question/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

export async function POST(request: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  if (!user) return NextResponse.json({ error: "User not found" }, { status: 404 });

  const { facultyId, content } = await request.json();

  try {
    const newQuestion = await prisma.question.create({
      data: {
        content,
        facultyId,
        userId: user.id,
      },
    });
    return NextResponse.json(newQuestion);
  } catch (error) {
    return NextResponse.json({ error: "Error posting question" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\register\route.ts
--------------------------------------------------
//src/app/api/register/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import argon2 from "argon2";
import { v4 as uuidv4 } from "uuid";
import { sendVerificationEmail } from "@/lib/email";

export async function POST(request: Request) {
  try {
    const { name, nickname, studentId, email, password } = await request.json();

    const validationErrors = [];


    if (!name || !nickname || !studentId || !email || !password) {
      return NextResponse.json({ errors: ["All fields are required."] }, { status: 400 });
    }

    if (!email.endsWith("uiu.ac.bd")) {
      validationErrors.push("Use only UIU email.");
    }

    if (studentId.length < 10) {
      validationErrors.push("Student ID must be at least 10 digits long.");
    }

    if (password.length < 8) {
      validationErrors.push("Password must be at least 8 characters long.");
    }

    const strongPassword =
      /[A-Z]/.test(password) &&
      /[a-z]/.test(password) &&
      /[0-9]/.test(password) &&
      /[^A-Za-z0-9]/.test(password);

    if (!strongPassword) {
      validationErrors.push("Password must contain: Uppercase, Lowercase, Number & Special char.");
    }

    
    if (email.endsWith("uiu.ac.bd") && validationErrors.length === 0) {
      try {
        const apiKey = process.env.ABSTRACT_API_KEY;

        if (apiKey) {
          
            const response = await fetch(`https://emailvalidation.abstractapi.com/v1/?api_key=${apiKey}&email=${email}`);
            const data = await response.json();

            
            if (data.email_deliverability && data.email_deliverability.status === "UNDELIVERABLE") {
                validationErrors.push("‡¶è‡¶á ‡¶á‡¶Æ‡ßá‡¶á‡¶≤‡¶ü‡¶ø ‡¶ñ‡ßÅ‡¶Å‡¶ú‡ßá ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡¶ø‡¶®‡•§");
            } 
            
            if (data.email_quality && data.email_quality.is_disposable === true) {
                validationErrors.push("‡¶´‡ßá‡¶ï/‡¶°‡¶ø‡¶∏‡¶™‡ßã‡¶ú‡ßá‡¶¨‡¶≤ ‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ‡•§");
            }
        } else {
            console.warn("API Key ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§ ‡¶≠‡ßç‡¶Ø‡¶æ‡¶≤‡¶ø‡¶°‡ßá‡¶∂‡¶® ‡¶∏‡ßç‡¶ï‡¶ø‡¶™ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
        }

      } catch (err) {
        console.error("Email Validation API Error:", err);
        
      }
    }
    


    
    if (validationErrors.length > 0) {
      return NextResponse.json({ errors: validationErrors }, { status: 400 });
    }

    
    const exists = await prisma.user.findFirst({
      where: {
        OR: [{ email }, { studentId }, { nickname }]
      },
    });

    if (exists) {
      const dbErrors = [];
      if (exists.email === email) dbErrors.push("Email already exists.");
      if (exists.studentId === studentId) dbErrors.push("This Student ID already exists.");
      if (exists.nickname === nickname) dbErrors.push("This Nickname already taken. Use different Nickname");
      
      return NextResponse.json({ errors: dbErrors }, { status: 409 });
    }

  
    const hashedPassword = await argon2.hash(password, {
      type: argon2.argon2id,
      memoryCost: 2 ** 16,
      timeCost: 3,
      parallelism: 1
    });

    await prisma.user.create({
      data: {
        name,
        nickname,
        studentId,
        email,
        password: hashedPassword,
        role: "STUDENT",
        emailVerified: null,
      },
    });

    const token = uuidv4();
    const expires = new Date(Date.now() + 15 * 60 * 1000);
    await prisma.verificationToken.create({
      data: {
        identifier: email,
        token,
        expires,
      },
    });

    await sendVerificationEmail(email, token);

    return NextResponse.json({
      message: "Registration successful. Please verify your email.",
    });

  } catch (error) {
    console.error("Registration Error:", error);
    return NextResponse.json(
      { errors: ["Server error during registration."] }, 
      { status: 500 }
    );
  }
}


--------------------------------------------------
FILE: src\app\api\report\route.ts
--------------------------------------------------
// src/app/api/report/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../auth/[...nextauth]/route";

export async function POST(request: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Login required to report" }, { status: 401 });
  }

  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  if (!user) return NextResponse.json({ error: "User not found" }, { status: 404 });

  const { reviewId, reason } = await request.json();

  try {
    await prisma.report.create({
      data: {
        reason,
        reviewId,
        userId: user.id,
      },
    });
    return NextResponse.json({ message: "Reported successfully" });
  } catch (error) {
    return NextResponse.json({ error: "Error reporting" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\review\route.ts
--------------------------------------------------
// src/app/api/review/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../auth/[...nextauth]/route";
import { z } from "zod";

const bannedWords = ["bad", "worst", "useless", "stupid", "idiot", "fake", "baje", "faltu", "gali"];

const reviewSchema = z.object({
  rating: z.coerce.number().min(1).max(5),
  comment: z.string().min(5).max(500),
  course: z.string().max(20).optional(),
  facultyId: z.string(),
});

export async function POST(request: Request) {
  try {
    const session = await getServerSession(authOptions);
    if (!session || !session.user?.email) {
      return NextResponse.json({ error: "Unauthorized! Please login first." }, { status: 401 });
    }

    const user = await prisma.user.findUnique({
      where: { email: session.user.email },
    });

    if (!user) return NextResponse.json({ error: "User not found" }, { status: 404 });

    const json = await request.json();
    const validation = reviewSchema.safeParse(json);

    if (!validation.success) {
      return NextResponse.json(
        { error: "Invalid data! Comment must be 5-500 chars & Rating 1-5." },
        { status: 400 }
      );
    }

    const { facultyId, rating, comment, course } = validation.data;

    const fiveMinutesAgo = new Date(Date.now() - 5 * 60 * 1000);
    const recentReview = await prisma.review.findFirst({
      where: {
        userId: user.id,
        createdAt: {
          gte: fiveMinutesAgo,
        },
      },
    });

    if (recentReview) {
      return NextResponse.json(
        { error: "Please wait 5 minutes before posting another review! ‚è≥" },
        { status: 429 }
      );
    }

    const containsBadWord = bannedWords.some((word) =>
      comment.toLowerCase().includes(word)
    );

    if (containsBadWord) {
      return NextResponse.json(
        { error: "Review contains inappropriate language. Please be respectful. üö´" },
        { status: 400 }
      );
    }

    const newReview = await prisma.review.create({
      data: {
        rating,
        comment,
        course: course ? course.toUpperCase() : "GENERAL",
        facultyId,
        userId: user.id,
        status: "PENDING",
      },
    });

    
    try {
      const admins = await prisma.user.findMany({
        where: { role: "ADMIN" },
        select: { id: true }
      });

      if (admins.length > 0) {
        await prisma.notification.createMany({
          data: admins.map((admin) => ({
            userId: admin.id,
            type: "SYSTEM", 
            message: `üìù New review posted by @${user.nickname || "Student"}. Needs approval.`,
            link: `/admin`, 
            isRead: false,
          })),
        });
      }
    } catch (notifError) {
      console.error("Failed to send admin notifications:", notifError);
    }

    return NextResponse.json(newReview);
  } catch (error) {
    console.error("Review Error:", error);
    return NextResponse.json({ error: "Error submitting review" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\user\update\route.ts
--------------------------------------------------

import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../../auth/[...nextauth]/route";

export async function PUT(request: Request) {
  const session = await getServerSession(authOptions);
  
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }

  const { nickname, semester } = await request.json();

  
  const existingUser = await prisma.user.findUnique({
    where: { nickname },
  });

  
  if (existingUser && existingUser.email !== session.user.email) {
    return NextResponse.json({ error: "Nickname already taken!" }, { status: 400 });
  }

  try {
    const updatedUser = await prisma.user.update({
      where: { email: session.user.email },
      data: { nickname, semester },
    });
    return NextResponse.json(updatedUser);
  } catch (error) {
    return NextResponse.json({ error: "Error updating profile" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\api\vote\route.ts
--------------------------------------------------
// src/app/api/vote/route.ts
import { NextResponse } from "next/server";
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "../auth/[...nextauth]/route";

export async function POST(request: Request) {
  const session = await getServerSession(authOptions);
  if (!session || !session.user?.email) {
    return NextResponse.json({ error: "Unauthorized" }, { status: 401 });
  }


  const user = await prisma.user.findUnique({ where: { email: session.user.email } });
  if (!user) return NextResponse.json({ error: "User not found" }, { status: 404 });

  const { reviewId, type } = await request.json(); 

  const existingVote = await prisma.vote.findUnique({
    where: {
      userId_reviewId: {
        userId: user.id,
        reviewId: reviewId,
      },
    },
  });

  try {
    if (existingVote) {
      if (existingVote.type === type) {
        await prisma.vote.delete({
          where: { id: existingVote.id },
        });
        return NextResponse.json({ message: "Vote removed" });
      } else {
        await prisma.vote.update({
          where: { id: existingVote.id },
          data: { type },
        });
        return NextResponse.json({ message: "Vote updated" });
      }
    } else {
      await prisma.vote.create({
        data: {
          userId: user.id,
          reviewId,
          type,
        },
      });

     
      if (type === "UP") {
        const review = await prisma.review.findUnique({ where: { id: reviewId } });

        
        if (review && review.userId !== user.id) {
          try {
            await prisma.notification.create({
              data: {
                userId: review.userId, 
                type: "VOTE",
                message: `üëç Someone liked your review!`,
                link: `/faculty/${review.facultyId}`, 
                isRead: false,
              },
            });
          } catch (notifError) {
            console.error("Notification failed", notifError);
          }
        }
      }

      return NextResponse.json({ message: "Vote added" });
    }
  } catch (error) {
    return NextResponse.json({ error: "Error voting" }, { status: 500 });
  }
}


--------------------------------------------------
FILE: src\app\auth-error\page.tsx
--------------------------------------------------
// src/app/auth-error/page.tsx
"use client";

import { useSearchParams } from "next/navigation";
import { Suspense } from "react";
import Link from "next/link";

function AuthErrorContent() {
  const searchParams = useSearchParams();
  const error = searchParams.get("error");

  return (
    <div className="flex flex-col items-center justify-center min-h-screen bg-gray-900 text-white p-4 text-center">
      <h1 className="text-4xl font-bold text-red-500 mb-4">Authentication Error ‚ö†Ô∏è</h1>
      <p className="text-gray-300 mb-8 text-lg">
        {error ? `Error Code: ${error}` : "An unknown error occurred during login."}
      </p>
      <Link 
        href="/" 
        className="bg-indigo-600 text-white px-6 py-2 rounded-full hover:bg-indigo-500 transition font-medium"
      >
        ‚Üê Back to Home
      </Link>
    </div>
  );
}

export default function AuthErrorPage() {
  return (
    <Suspense fallback={<div className="text-white text-center p-10">Loading error details...</div>}>
      <AuthErrorContent />
    </Suspense>
  );
}


--------------------------------------------------
FILE: src\app\compare\page.tsx
--------------------------------------------------

import prisma from "@/lib/prisma";
import CompareView from "@/components/CompareView";
import Link from "next/link";
export const dynamic = "force-dynamic";
export default async function ComparePage() {
  const faculties = await prisma.faculty.findMany({
    include: { reviews: { select: { rating: true } } },
    orderBy: { name: "asc" },
  });

  return (
    <div className="min-h-screen p-8">
      <header className="mb-8 max-w-6xl mx-auto">
        <Link href="/" className="text-indigo-600 dark:text-indigo-400 hover:underline mb-4 block">‚Üê Back to Home</Link>
      </header>

      <main className="flex justify-center">
        <CompareView faculties={faculties} />
      </main>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\faculty\[id]\page.tsx
--------------------------------------------------
import prisma from "@/lib/prisma";
import { notFound } from "next/navigation";
import Link from "next/link";
import FacultyRatingChart from "@/components/FacultyRatingChart";
import UserBadge from "@/components/UserBadge";
import ReviewForm from "@/components/ReviewForm";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import type { Metadata } from "next";
import FadeIn from "@/components/FadeIn"; 
import ReviewModalButton from "@/components/ReviewModalButton";
import FollowButton from "@/components/FollowButton";

interface Props {
  params: Promise<{ id: string }>;
}

export async function generateMetadata({ params }: Props): Promise<Metadata> {
  const { id } = await params;
  const faculty = await prisma.faculty.findUnique({
    where: { id },
    select: { name: true, designation: true, department: true }
  });

  if (!faculty) return { title: "Faculty Not Found" };

  const title = `Review of ${faculty.name} | Faculty Review App`;
  const description = `Read honest reviews about ${faculty.name} (${faculty.designation}, ${faculty.department}). 100% Anonymous.`;

  return {
    title,
    description,
    openGraph: { title, description, type: "website", siteName: "Faculty Review App" },
    twitter: { card: "summary_large_image", title, description },
  };
}

export default async function FacultyProfilePage(props: Props) {
  const params = await props.params;
  const session = await getServerSession(authOptions);

  
  let isFollowing = false;
  if (session?.user?.email) {
    const user = await prisma.user.findUnique({
      where: { email: session.user.email },
      include: { followedFaculties: { where: { id: params.id } } }
    });
    if (user && user.followedFaculties.length > 0) isFollowing = true;
  }

  const faculty = await prisma.faculty.findUnique({
    where: { id: params.id },
    include: {
      reviews: {
        include: {
          user: { 
            select: { id: true, nickname: true, role: true, _count: { select: { reviews: true } } } 
          },
        },
        orderBy: { createdAt: "desc" },
      },
    },
  });

  if (!faculty) return notFound();

  const totalReviews = faculty.reviews.length;
  const averageRating = totalReviews > 0
      ? (faculty.reviews.reduce((acc, r) => acc + r.rating, 0) / totalReviews).toFixed(1)
      : "0.0";

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900 p-4 md:p-8">
      <div className="max-w-6xl mx-auto">
        <Link href="/" className="inline-block mb-6 text-indigo-600 dark:text-indigo-400 hover:underline">
          &larr; Back to Faculty List
        </Link>

        <FadeIn className="glass-card rounded-2xl p-6 md:p-8 mb-8">
            <div className="flex flex-col md:flex-row items-center md:items-start gap-6">
              <div className="w-24 h-24 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-4xl text-white font-bold shadow-md">
                {faculty.name.charAt(0)}
              </div>
              <div className="flex-1 text-center md:text-left">
                <div className="flex flex-col md:flex-row justify-between items-center md:items-start">
                  <div>
                    <h1 className="text-3xl font-bold text-gray-900 dark:text-white mb-2">
                      {faculty.name}
                    </h1>
                    <p className="text-gray-600 dark:text-gray-400 text-lg mb-4">
                      {faculty.designation}  of {faculty.department} Dept.
                    </p>
                  </div>
                  <div className="mt-4 md:mt-0">
                    <FollowButton facultyId={faculty.id} initialIsFollowing={isFollowing} />
                  </div>
                </div>

                <div className="flex items-center justify-center md:justify-start gap-4 mt-2">
                  <div className="bg-indigo-50 dark:bg-indigo-900/30 px-4 py-2 rounded-lg border border-indigo-100 dark:border-indigo-800">
                    <span className="block text-2xl font-bold text-indigo-600 dark:text-indigo-400">
                      {averageRating} <span className="text-base text-yellow-500">‚òÖ</span>
                    </span>
                    <span className="text-xs text-gray-500 uppercase font-semibold">Avg Rating</span>
                  </div>
                  <div className="bg-gray-50 dark:bg-gray-700/30 px-4 py-2 rounded-lg border border-gray-100 dark:border-gray-700">
                    <span className="block text-2xl font-bold text-gray-800 dark:text-white">
                      {totalReviews}
                    </span>
                    <span className="text-xs text-gray-500 uppercase font-semibold">Total Reviews</span>
                  </div>
                </div>
              </div>
            </div>
        </FadeIn>

        {/* --- Content Grid --- */}
        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          
          <FadeIn delay={0.2} className="md:col-span-1 space-y-6">
             <FacultyRatingChart reviews={faculty.reviews} />
             <div className="glass-card p-6 rounded-xl hover:scale-[1.01] transition-transform duration-300">
                <h3 className="font-bold text-gray-700 dark:text-gray-300 mb-2">üí° Quick Tip</h3>
                <p className="text-sm text-gray-500">
                  Follow this faculty to get notified when new reviews are posted!
                </p>
             </div>
          </FadeIn>

          <div className="md:col-span-2">
            
            <FadeIn delay={0.3} className="mb-8">
              {session ? (
                  <div className="bg-indigo-50 dark:bg-indigo-900/10 p-6 rounded-2xl border border-indigo-100 dark:border-indigo-800 flex flex-col items-center text-center">
                    <h3 className="text-xl font-bold text-gray-900 dark:text-white mb-2">Have you taken a course?</h3>
                    <p className="text-gray-500 dark:text-gray-400 mb-4 text-sm">Share your experience to help others.</p>
                    <div className="w-full max-w-xs">
                      <ReviewModalButton facultyId={faculty.id} />
                    </div>
                  </div>
              ) : (
                <div className="bg-indigo-50 dark:bg-indigo-900/20 p-6 rounded-lg border border-indigo-100 dark:border-indigo-800 text-center">
                  <p className="text-gray-600 dark:text-gray-300 mb-4 font-medium">Want to share your experience?</p>
                  <Link href="/login" className="bg-indigo-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-indigo-700 transition shadow-md">
                    Login to Write a Review
                  </Link>
                </div>
              )}
            </FadeIn>

            <h2 className="text-2xl font-bold text-gray-900 dark:text-white mb-6 flex items-center gap-2">
              Student Reviews <span className="text-base font-normal text-gray-500">({totalReviews})</span>
            </h2>

            <div className="space-y-4">
              {faculty.reviews.length === 0 ? (
                <div className="text-center py-10 bg-white dark:bg-gray-800 rounded-lg border border-dashed border-gray-300 dark:border-gray-700">
                  <p className="text-gray-500 text-lg">No reviews yet. Be the first to review!</p>
                </div>
              ) : (
                faculty.reviews.map((review, index) => (
                  
                  <FadeIn 
                    key={review.id} 
                    delay={index * 0.1} 
                    className="glass-card p-6 rounded-xl hover:scale-[1.01] transition-transform duration-300"
                  >
                      <div className="flex justify-between items-start mb-3">
                        <div className="flex items-center gap-3">
                          <div className="w-8 h-8 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center text-sm">üë§</div>
                          <div>
                            <div className="flex items-center gap-2">
                              <Link href={`/student/${review.user.id}`} className="font-bold text-gray-800 dark:text-white hover:text-indigo-500">
                                  @{review.user?.nickname || "Anonymous"}
                              </Link>
                              <UserBadge reviewCount={review.user?._count?.reviews || 0} role={review.user?.role} />
                            </div>
                            <p className="text-xs text-gray-500">{new Date(review.createdAt).toLocaleDateString()}</p>
                          </div>
                        </div>
                        <div className="bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 px-2 py-1 rounded text-sm font-bold">
                          ‚òÖ {review.rating}
                        </div>
                      </div>

                      <div className="mb-2">
                        <span className="text-xs font-semibold bg-indigo-50 dark:bg-indigo-900/50 text-indigo-600 dark:text-indigo-300 px-2 py-0.5 rounded">
                          Course: {review.course}
                        </span>
                      </div>

                      <p className="text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap">
                        {review.comment}
                      </p>
                  </FadeIn>
                ))
              )}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\forgot-password\page.tsx
--------------------------------------------------
//src/app/forgot-password/page.tsx
"use client";

import { useState } from "react";
import toast from "react-hot-toast";
import Link from "next/link";

export default function ForgotPasswordPage() {
  const [email, setEmail] = useState("");
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const res = await fetch("/api/auth/forgot-password", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email }),
      });

      toast.success("If an account exists, a reset link has been sent to your email.");
      setEmail(""); 
    } catch (error) {
      toast.error("Something went wrong. Please try again.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-50 dark:bg-gray-900 px-4">
      <div className="w-full max-w-md bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700">
        <h2 className="text-2xl font-bold mb-4 text-gray-900 dark:text-white text-center">Reset Password</h2>
        <p className="text-sm text-gray-600 dark:text-gray-400 text-center mb-6">
          Enter your email address and we'll send you a link to reset your password.
        </p>
        
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Email Address</label>
            <input
              type="email"
              placeholder="name@uiu.ac.bd"
              required
              className="w-full p-3 border rounded-md dark:bg-gray-700 dark:border-gray-600 outline-none focus:border-indigo-500 transition"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
            />
          </div>
          
          <button 
            disabled={loading} 
            className="w-full bg-indigo-600 text-white p-3 rounded font-bold hover:bg-indigo-700 transition disabled:opacity-50"
          >
            {loading ? "Sending Link..." : "Send Reset Link"}
          </button>
        </form>

        <div className="text-center mt-4">
          <Link href="/login" className="text-sm text-indigo-600 hover:underline">
            Back to Login
          </Link>
        </div>
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\globals.css
--------------------------------------------------
 

@tailwind base;
@tailwind components;
@tailwind utilities;


:root {
  --font-inter: 'Inter', sans-serif;
  --font-jakarta: 'Plus Jakarta Sans', sans-serif;
}


body {
  font-family: var(--font-inter);
}


h1, h2, h3, h4, h5, h6 {
  font-family: var(--font-jakarta);
  letter-spacing: -0.02em;
}



::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: transparent; 
}

::-webkit-scrollbar-thumb {
  background-color: #cbd5e1;
  border-radius: 20px;
  border: 2px solid transparent;
  background-clip: content-box;
}

::-webkit-scrollbar-thumb:hover {
  background-color: #94a3b8;
}


.dark ::-webkit-scrollbar-thumb {
  background-color: #475569;
}
.dark ::-webkit-scrollbar-thumb:hover {
  background-color: #64748b;
}


html {
  scroll-behavior: smooth;
}


@layer utilities {
  .glass {
    @apply bg-white/70 dark:bg-gray-900/70 backdrop-blur-md border border-white/20 dark:border-gray-700/30;
  }
  
  .text-gradient {
    @apply bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-600;
  }
}
@layer components {
 
  .glass-card {
    @apply bg-white/80 dark:bg-gray-800/60 backdrop-blur-md border border-gray-200/50 dark:border-gray-700/50 shadow-xl;
  }
}
 
  .glass-card:hover {
    @apply border-indigo-500/30 dark:border-indigo-400/30 shadow-2xl;
  }


body {
  -webkit-user-select: none;
  -moz-user-select: none;   
  -ms-user-select: none;    
  user-select: none;        
}


input, textarea {
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}


--------------------------------------------------
FILE: src\app\layout.tsx
--------------------------------------------------
// src/app/layout.tsx

import type { Metadata } from "next";
import { Inter, Plus_Jakarta_Sans } from "next/font/google";
import "./globals.css";
import AuthProvider from "@/components/AuthProvider";
import { Toaster } from "react-hot-toast";
import { ThemeProvider } from "@/providers/ThemeProvider";
import Footer from "@/components/Footer";
import ContentProtector from "@/components/ContentProtector";
import Navbar from "@/components/Navbar";
import SessionGuard from "@/components/SessionGuard"; 

const inter = Inter({ 
  subsets: ["latin"], 
  variable: "--font-inter" 
});

const jakarta = Plus_Jakarta_Sans({ 
  subsets: ["latin"], 
  variable: "--font-jakarta" 
});

export const metadata: Metadata = {
  title: {
    template: '%s | Faculty Review App', 
    default: 'Faculty Review App',       
  },
  description: "Review your university faculty members anonymously",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className={`${inter.variable} ${jakarta.variable} bg-gray-50 dark:bg-gray-950 text-gray-900 dark:text-white transition-colors duration-300 font-sans`}>
        <ThemeProvider attribute="class" defaultTheme="system" enableSystem>
          <AuthProvider>
            <SessionGuard /> 
            
            <ContentProtector />
            <Toaster position="bottom-right" toastOptions={{ 
              duration: 4000,
              style: {
                background: '#333',
                color: '#fff',
                borderRadius: '10px',
              }
            }} />
            
            <div className="flex flex-col min-h-screen">
              <Navbar />
              <main className="flex-grow">
                {children}
              </main>
              <Footer />
            </div>
          </AuthProvider>
        </ThemeProvider>
      </body>
    </html>
  );
}


--------------------------------------------------
FILE: src\app\loading.tsx
--------------------------------------------------
export default function Loading() {
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-950 font-sans">
      
      <div className="max-w-7xl mx-auto px-6 py-6 flex justify-between items-center mb-8">
        <div className="h-8 w-48 bg-gray-200 dark:bg-gray-800 rounded-full animate-pulse"></div>
        <div className="flex gap-4">
          <div className="h-10 w-10 bg-gray-200 dark:bg-gray-800 rounded-full animate-pulse"></div>
          <div className="h-10 w-24 bg-gray-200 dark:bg-gray-800 rounded-full animate-pulse"></div>
        </div>
      </div>

      <div className="relative max-w-7xl mx-auto px-4 mb-16">
        <div className="relative overflow-hidden bg-white dark:bg-gray-900 rounded-[2.5rem] h-[400px] shadow-sm border border-gray-100 dark:border-gray-800 p-10 flex flex-col items-center justify-center animate-pulse">
          
          <div className="h-6 w-64 bg-gray-100 dark:bg-gray-800 rounded-full mb-6"></div>
          
          <div className="h-12 w-3/4 md:w-1/2 bg-gray-200 dark:bg-gray-800 rounded-full mb-4"></div>
          <div className="h-12 w-2/3 md:w-1/3 bg-gray-200 dark:bg-gray-800 rounded-full mb-8"></div>
          
          <div className="w-full max-w-2xl h-16 bg-gray-100 dark:bg-gray-800 rounded-2xl"></div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto px-6">
        
        <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-16">
          {[1, 2, 3, 4].map((i) => (
            <div key={i} className="bg-white dark:bg-gray-900 p-6 rounded-2xl border border-gray-100 dark:border-gray-800 shadow-sm flex items-center justify-between animate-pulse">
              <div className="space-y-2">
                <div className="h-3 w-20 bg-gray-200 dark:bg-gray-800 rounded-full"></div>
                <div className="h-8 w-12 bg-gray-300 dark:bg-gray-700 rounded-lg"></div>
              </div>
              <div className="h-12 w-12 bg-gray-100 dark:bg-gray-800 rounded-xl"></div>
            </div>
          ))}
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 pb-20">
          {[1, 2, 3, 4, 5, 6].map((i) => (
            <div key={i} className="bg-white dark:bg-gray-900 p-8 rounded-3xl border border-gray-100 dark:border-gray-800 shadow-sm relative animate-pulse">
              
              <div className="absolute top-6 right-6 h-8 w-24 bg-gray-100 dark:bg-gray-800 rounded-full"></div>

              <div className="mb-6 pr-24">
                <div className="h-8 w-3/4 bg-gray-200 dark:bg-gray-700 rounded-full mb-3"></div>
                <div className="h-4 w-1/3 bg-gray-100 dark:bg-gray-800 rounded-full mb-4"></div>
                
                <div className="flex gap-2">
                  <div className="h-6 w-16 bg-gray-100 dark:bg-gray-800 rounded-full"></div>
                  <div className="h-6 w-20 bg-gray-100 dark:bg-gray-800 rounded-full"></div>
                </div>
              </div>

              <div className="flex justify-between items-center bg-gray-50 dark:bg-gray-800/50 p-4 rounded-2xl mb-6">
                <div className="h-4 w-32 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
                <div className="h-4 w-16 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
              </div>

              <div className="space-y-3">
                <div className="h-24 bg-gray-50 dark:bg-gray-800/30 rounded-2xl w-full border border-gray-100 dark:border-gray-800"></div>
                <div className="h-24 bg-gray-50 dark:bg-gray-800/30 rounded-2xl w-full border border-gray-100 dark:border-gray-800 opacity-60"></div>
              </div>

            </div>
          ))}
        </div>
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\login\page.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import { signIn } from "next-auth/react";
import { useRouter } from "next/navigation";
import toast from "react-hot-toast";
import Link from "next/link";
import { FaEye, FaEyeSlash } from "react-icons/fa"; 

export default function LoginPage() {
  const [identifier, setIdentifier] = useState(""); 
  const [password, setPassword] = useState("");
  const [loading, setLoading] = useState(false);
  
  
  const [showPassword, setShowPassword] = useState(false);
  
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    const result = await signIn("credentials", {
      email: identifier, 
      password,
      redirect: false,
    });

    setLoading(false);

    if (result?.error) {
      toast.error("Invalid Email/ID or password");
    } else {
      toast.success("Logged in successfully!");
      router.refresh(); 
      router.push("/"); 
    }
  };

  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-50 dark:bg-gray-900 px-4">
      <div className="w-full max-w-md p-8 space-y-6 bg-white dark:bg-gray-800 rounded-lg shadow-md border border-gray-200 dark:border-gray-700">
        <h1 className="text-2xl font-bold text-center text-gray-900 dark:text-white">
          Welcome Back
        </h1>
        
        <form onSubmit={handleSubmit} className="space-y-4">
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">
              Email or Student ID
            </label>
            <input
              type="text" 
              value={identifier}
              onChange={(e) => setIdentifier(e.target.value)}
              required
              className="mt-1 block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition focus:border-indigo-500"
              placeholder="e.g. 01123456 or name@uiu.ac.bd" 
            />
          </div>
          
          <div>
            <label className="block text-sm font-medium text-gray-700 dark:text-gray-300">Password</label>
            
            {/* ‚úÖ ‡ß©. ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶∏‡ßá‡¶ï‡¶∂‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü */}
            <div className="relative mt-1">
              <input
                type={showPassword ? "text" : "password"} 
                value={password}
                onChange={(e) => setPassword(e.target.value)}
                required
                className="block w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm outline-none bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition focus:border-indigo-500 pr-10" 
                placeholder="********" 
              />
              <button
                type="button"
                onClick={() => setShowPassword(!showPassword)}
                className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-indigo-600 dark:text-gray-400 transition"
              >
                {showPassword ? <FaEyeSlash size={18} /> : <FaEye size={18} />}
              </button>
            </div>

            <div className="text-right mt-1">
              <Link href="/forgot-password" className="text-xs text-indigo-600 hover:text-indigo-500 hover:underline">
                Forgot Password?
              </Link>
            </div>
          </div>

          <button
            type="submit"
            disabled={loading}
            className="w-full py-2 px-4 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 disabled:opacity-50 transition transform active:scale-95"
          >
            {loading ? "Signing in..." : "Login"}
          </button>
        </form>

        <div className="text-center text-sm mt-4">
          <span className="text-gray-600 dark:text-gray-400">Don't have an account? </span>
          <Link href="/register" className="font-medium text-indigo-600 hover:text-indigo-500">Sign up</Link>
        </div>
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\page.tsx
--------------------------------------------------
import AdminReviewDeleteButton from "@/components/AdminReviewDeleteButton";
import prisma from "@/lib/prisma";
import AuthButtons from "@/components/AuthButtons";
import AddFacultyForm from "@/components/AddFacultyForm";
import ReviewModalButton from "@/components/ReviewModalButton";
import VoteButtons from "@/components/VoteButtons";
import QASection from "@/components/QASection";
import ReportButton from "@/components/ReportButton";
import Pagination from "@/components/Pagination";
import Link from "next/link";
import UserBadge from "@/components/UserBadge"; 
import NotificationBell from "@/components/NotificationBell"; 
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import FadeIn from "@/components/FadeIn";
import SearchBox from "@/components/SearchBox"; 
import ProfileMenu from "@/components/ProfileMenu";

export const dynamic = "force-dynamic";

interface Props {
  searchParams: Promise<{ q?: string; page?: string }>;
}

const getTags = (avgRating: number, reviewCount: number) => {
  const tags = [];
  if (reviewCount > 2 && avgRating >= 4.5) tags.push({ label: "üíé Gem", color: "bg-purple-100 text-purple-800 dark:bg-purple-900/50 dark:text-purple-200 border border-purple-200 dark:border-purple-700" });
  else if (reviewCount > 2 && avgRating >= 4.0) tags.push({ label: "‚ù§Ô∏è Friendly", color: "bg-green-100 text-green-800 dark:bg-green-900/50 dark:text-green-200 border border-green-200 dark:border-green-700" });
  else if (reviewCount > 2 && avgRating <= 2.5) tags.push({ label: "üíÄ Strict", color: "bg-red-100 text-red-800 dark:bg-red-900/50 dark:text-red-200 border border-red-200 dark:border-red-700" });
  
  if (reviewCount >= 5) tags.push({ label: "üî• Popular", color: "bg-orange-100 text-orange-800 dark:bg-orange-900/50 dark:text-orange-200 border border-orange-200 dark:border-orange-700" });
  if (reviewCount === 0) tags.push({ label: "üÜï New", color: "bg-blue-100 text-blue-800 dark:bg-blue-900/50 dark:text-blue-200 border border-blue-200 dark:border-blue-700" });

  return tags;
};

export default async function HomePage(props: Props) {
  const searchParams = await props.searchParams;
  const query = searchParams.q || "";
  const page = parseInt(searchParams.page || "1");
  const itemsPerPage = 10;
  const session = await getServerSession(authOptions);

  let isAdmin = false;
  let currentUserId = "";
  
  if (session?.user?.email) {
    const user = await prisma.user.findUnique({ where: { email: session.user.email } });
    isAdmin = user?.role === "ADMIN";
    currentUserId = user?.id || "";
  }

  const faculties = await prisma.faculty.findMany({
    where: {
      status: "APPROVED",
      OR: [
        { name: { contains: query, mode: "insensitive" } },
        { department: { contains: query, mode: "insensitive" } },
        { code: { contains: query, mode: "insensitive" } },
        { initial: { contains: query, mode: "insensitive" } }
      ],
    },
    include: {
      reviews: {
        where: { status: "APPROVED" },
        orderBy: { createdAt: "desc" },
        include: {
          user: { 
            select: { 
              id: true, 
              nickname: true, 
              semester: true, 
              role: true, 
              _count: { select: { reviews: true } } 
            } 
          },
          votes: true,
          reports: true
        }
      },
      questions: {
        orderBy: { createdAt: "desc" },
        include: {
          user: { select: { id: true, nickname: true, semester: true } },
          answers: {
            orderBy: { createdAt: "asc" },
            include: { user: { select: { id: true, nickname: true, semester: true } } }
          }
        }
      }
    },
  });

  const facultiesWithStats = faculties.map(faculty => {
    const totalRating = faculty.reviews.reduce((sum, review) => sum + review.rating, 0);
    const avgRating = faculty.reviews.length > 0 ? totalRating / faculty.reviews.length : 0;
    const tags = getTags(avgRating, faculty.reviews.length);
    return { ...faculty, avgRating, tags };
  });

  facultiesWithStats.sort((a, b) => b.avgRating - a.avgRating);
  const topFaculties = facultiesWithStats.slice(0, 3);
  
  const startIndex = (page - 1) * itemsPerPage;
  const paginatedFaculties = facultiesWithStats.slice(startIndex, startIndex + itemsPerPage);

  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-950 font-sans">
      
      <div className="relative overflow-hidden bg-slate-900 text-white pb-24 pt-10 px-4 rounded-b-[2.5rem] shadow-2xl mb-12">
        
        <div className="absolute top-0 left-0 w-full h-full overflow-hidden z-0 pointer-events-none">
          <div className="absolute top-[-20%] left-[-10%] w-[500px] h-[500px] bg-purple-600/30 rounded-full blur-[120px] animate-pulse"></div>
          <div className="absolute bottom-[-10%] right-[-10%] w-[500px] h-[500px] bg-indigo-600/30 rounded-full blur-[120px] animate-pulse delay-1000"></div>
        </div>

        <div className="relative z-10 max-w-4xl mx-auto text-center">
          <span className="inline-block py-1.5 px-4 rounded-full bg-indigo-500/20 border border-indigo-400/30 text-indigo-300 text-xs md:text-sm font-bold mb-6 uppercase tracking-wider">
            üöÄ The #1 Review Platform for Students
          </span>
          
          <h1 className="text-4xl md:text-6xl font-black mb-6 tracking-tight leading-tight">
            Rate Your <br className="hidden md:block" />
            <span className="text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 via-purple-400 to-pink-400">
              Faculty Mentors
            </span>
          </h1>
          
          <p className="text-base md:text-xl text-gray-300 mb-10 max-w-2xl mx-auto leading-relaxed">
            Share your honest feedback anonymously, help juniors choose the best courses, and build a transparent community.
          </p>

          <div className="mt-8 mb-4">
            <SearchBox />
          </div>

          <div className="mt-10 flex flex-wrap justify-center gap-6 text-sm font-medium text-gray-400">
            <div className="flex items-center gap-2 bg-white/5 px-4 py-2 rounded-full border border-white/10">
              <span className="w-2 h-2 bg-green-400 rounded-full shadow-[0_0_10px_rgba(74,222,128,0.5)]"></span> 100% Anonymous
            </div>
            <div className="flex items-center gap-2 bg-white/5 px-4 py-2 rounded-full border border-white/10">
              <span className="w-2 h-2 bg-blue-400 rounded-full shadow-[0_0_10px_rgba(96,165,250,0.5)]"></span> Verified Students
            </div>
          </div>
        </div>
      </div>


      <main className="flex flex-col items-center w-full px-4 md:px-8 max-w-7xl mx-auto">
        
        {page === 1 && !query && topFaculties.length > 0 && topFaculties[0].avgRating > 0 && (
          <div className="w-full mb-16">
            <h2 className="text-2xl font-bold text-gray-800 dark:text-white mb-6 flex items-center gap-2">
              <span className="text-3xl">üèÜ</span> Top Rated Faculties
            </h2>
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {topFaculties.map((faculty, index) => (
                <div key={faculty.id} className={`p-6 rounded-2xl relative overflow-hidden transition-all duration-300 hover:-translate-y-1 ${
                  index === 0 
                    ? "bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 border border-yellow-200 dark:border-yellow-700/50 shadow-lg shadow-yellow-500/10" 
                    : "bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-md"
                }`}>
                  {index === 0 && (
                    <div className="absolute top-0 right-0 bg-gradient-to-l from-yellow-500 to-orange-500 text-white text-[10px] px-3 py-1 font-bold rounded-bl-xl shadow-sm">
                      #1 STUDENT CHOICE
                    </div>
                  )}
                  
                  <Link href={`/faculty/${faculty.id}`}>
                    <h3 className="text-xl font-bold text-gray-900 dark:text-white hover:text-indigo-600 transition cursor-pointer mb-2">
                        {faculty.name}
                    </h3>
                  </Link>
                  
                  <div className="flex flex-wrap gap-2 mb-3">
                    {faculty.tags.map((tag, i) => (
                      <span key={i} className={`text-[10px] px-2 py-0.5 rounded-full font-bold uppercase tracking-wide ${tag.color}`}>
                        {tag.label}
                      </span>
                    ))}
                  </div>

                  <p className="text-sm text-gray-500 dark:text-gray-400 font-medium mb-4"> {faculty.designation}  of {faculty.department} Dept.</p> 
                  
                  <div className="flex items-center gap-3 pt-4 border-t border-gray-100 dark:border-gray-700/50">
                    <span className="text-3xl font-black text-gray-800 dark:text-white">{faculty.avgRating.toFixed(1)}</span>
                    <div className="flex flex-col">
                      <div className="flex text-yellow-400 text-sm">
                          {"‚òÖ".repeat(Math.round(faculty.avgRating))}
                          <span className="text-gray-300 dark:text-gray-600">{"‚òÖ".repeat(5 - Math.round(faculty.avgRating))}</span>
                      </div>
                      <span className="text-xs text-gray-400">{faculty.reviews.length} Reviews</span>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {session && !query && <AddFacultyForm />}

        <div className="w-full grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
          {paginatedFaculties.length === 0 ? (
            <div className="col-span-1 lg:col-span-2 text-center py-20 bg-white dark:bg-gray-800 rounded-2xl border border-dashed border-gray-300 dark:border-gray-700">
              <p className="text-gray-500 dark:text-gray-400 text-xl font-medium">No faculty found matching "{query}"</p>
              <p className="text-gray-400 mt-2">Try searching by Department.</p>
              {query && <a href="/" className="text-indigo-500 hover:underline mt-4 inline-block font-bold">Clear Search</a>}
            </div>
          ) : (
            paginatedFaculties.map((faculty, index) => (
              <FadeIn 
                key={faculty.id} 
                delay={index * 0.1}
                className="glass-card p-6 md:p-8 rounded-2xl transition-all duration-300 group relative flex flex-col h-full hover:-translate-y-1"
              >
                  <Link href={`/faculty/${faculty.id}`} className="absolute top-6 right-6 text-xs font-bold text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/30 px-3 py-1.5 rounded-full hover:bg-indigo-100 dark:hover:bg-indigo-900/50 transition">
                      View Profile &rarr;
                  </Link>

                  <div className="mb-4 pr-24">
                    <Link href={`/faculty/${faculty.id}`} title={`View profile of ${faculty.name}`} >
                        <h2 className="text-2xl font-bold text-gray-900 dark:text-white hover:text-indigo-600 transition cursor-pointer mb-1">
                            {faculty.name}
                        </h2>
                    </Link>
                    <p className="text-indigo-600 dark:text-indigo-400 text-sm font-semibold">{faculty.designation}  of {faculty.department} Dept.</p>
                    
                    <div className="flex flex-wrap gap-2 mt-3">
                      {faculty.tags.map((tag, i) => (
                        <span key={i} className={`text-[10px] px-2 py-0.5 rounded-full font-bold uppercase ${tag.color}`}>
                          {tag.label}
                        </span>
                      ))}
                    </div>
                  </div>

                  <div className="flex justify-between items-center bg-gray-50 dark:bg-gray-700/30 p-3 rounded-xl mb-6">
                      <span className="text-gray-600 dark:text-gray-300 text-xs font-bold uppercase tracking-wide">
                        Total Reviews: {faculty.reviews.length}
                      </span>
                      {faculty.reviews.length > 0 && (
                        <span className="text-yellow-500 text-base font-black flex items-center gap-1">
                          ‚òÖ {faculty.avgRating.toFixed(1)}
                        </span>
                      )}
                  </div>

                  <div className="space-y-4 max-h-80 overflow-y-auto mb-6 pr-2 custom-scrollbar flex-1">
                    {faculty.reviews.length === 0 && (
                      <div className="text-center py-6">
                        <p className="text-gray-400 text-sm italic">No reviews yet. Be the first!</p>
                      </div>
                    )}
                    
                    {faculty.reviews.map((review) => (
                      <div key={review.id} className="bg-gray-50 dark:bg-gray-700/30 p-4 rounded-xl text-sm border border-gray-100 dark:border-gray-700/50">
                        <div className="flex flex-wrap justify-between items-start mb-2 gap-2">
                          <div className="flex items-center gap-2">
                            <span className="text-yellow-500 text-xs font-bold">{"‚òÖ".repeat(review.rating)}</span>
                            <span className="text-[10px] bg-indigo-100 dark:bg-indigo-900/50 text-indigo-700 dark:text-indigo-200 px-2 py-0.5 rounded-full font-bold">
                              {review.course}
                            </span>
                          </div>
                          
                          <div className="flex items-center gap-2">
                            <Link href={`/student/${review.user.id}`} className="group">
                              <span className="text-xs text-gray-500 dark:text-gray-400 font-mono group-hover:text-indigo-500 dark:group-hover:text-indigo-400 transition cursor-pointer">
                                @{review.user.nickname || "Anonymous"} 
                              </span>
                            </Link>
                            <UserBadge reviewCount={review.user._count.reviews} role={review.user.role} />
                          </div>
                        </div>
                        
                        <p className="text-gray-700 dark:text-gray-200 mt-1 leading-relaxed">
                          {review.comment}
                        </p>
                        
                        <div className="mt-3 flex items-center justify-between border-t border-gray-200 dark:border-gray-600/50 pt-2">
                          <VoteButtons reviewId={review.id} initialVotes={review.votes} currentUserId={currentUserId} />

                          {isAdmin ? (
                                    <AdminReviewDeleteButton reviewId={review.id} />
                                  ) : (
                                    <ReportButton reviewId={review.id} />
                                  )}

                        </div>
                      </div>
                    ))}
                  </div>

                  <div className="mt-auto">
                    {session ? (
                      <ReviewModalButton facultyId={faculty.id} />
                    ) : (
                      <Link href="/login" className="w-full mt-4 block text-center bg-gray-100 dark:bg-gray-700/50 text-gray-600 dark:text-gray-400 font-bold py-2.5 rounded-xl hover:bg-indigo-600 hover:text-white transition-all duration-300">
                        Login to Review
                      </Link>
                    )}
                    
                    <QASection facultyId={faculty.id} questions={faculty.questions} session={session} />
                  </div>

              </FadeIn>
            ))
          )}
        </div>

        <Pagination totalItems={facultiesWithStats.length} itemsPerPage={itemsPerPage} currentPage={page} />
      </main>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\profile\page.tsx
--------------------------------------------------
// src/app/profile/page.tsx
import prisma from "@/lib/prisma";
import ProfileEditForm from "@/components/ProfileEditForm";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import { redirect } from "next/navigation";
import Link from "next/link";

export default async function ProfileDashboard() {
  const session = await getServerSession(authOptions);

  if (!session || !session.user?.email) {
    redirect("/");
  }

  const user = await prisma.user.findUnique({
    where: { email: session.user.email },
    include: {
      reviews: {
        orderBy: { createdAt: "desc" },
        include: { faculty: true, votes: true },
      },
    },
  });

  if (!user) return <p>User not found</p>;

  let reputationScore = 0;
  user.reviews.forEach((review) => {
    const upvotes = review.votes.filter((v) => v.type === "UP").length;
    const downvotes = review.votes.filter((v) => v.type === "DOWN").length;
    reputationScore += (upvotes - downvotes);
  });
  if (reputationScore < 0) reputationScore = 0;

  return (
    <div className="min-h-screen p-8"> 
      <div className="max-w-6xl mx-auto">
        <header className="mb-8 border-b border-gray-200 dark:border-gray-800 pb-6 flex flex-col md:flex-row justify-between items-center gap-4">
          <div>
            <h1 className="text-3xl font-bold text-gray-900 dark:text-white">My Dashboard</h1>
            <p className="text-gray-600 dark:text-gray-400 text-sm">Welcome back, {user.nickname || user.email}</p>
          </div>
          <Link href="/" className="text-indigo-600 dark:text-indigo-400 hover:underline text-sm">‚Üê Back to Home</Link>
        </header>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div className="space-y-6">
            <div className="bg-gradient-to-br from-indigo-500 to-purple-600 p-6 rounded-lg shadow-lg text-center text-white">
              <h3 className="text-indigo-100 text-sm font-bold uppercase tracking-wider mb-2">Reputation Score</h3>
              <div className="text-5xl font-bold mb-1">{reputationScore}</div>
              <p className="text-xs text-indigo-100 opacity-80">Points earned from helpful reviews</p>
            </div>

            <div className="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
               <ProfileEditForm initialNickname={user.nickname} initialSemester={user.semester} />
            </div>
          </div>

          <div className="md:col-span-2">
            <h2 className="text-xl font-bold mb-4 flex items-center gap-2 text-gray-900 dark:text-white">
              My Reviews <span className="bg-gray-200 dark:bg-gray-700 text-xs px-2 py-1 rounded-full text-gray-700 dark:text-gray-300">{user.reviews.length}</span>
            </h2>

            {user.reviews.length === 0 ? (
              <div className="bg-white dark:bg-gray-800 p-8 rounded-lg text-center border border-gray-200 dark:border-gray-700 shadow-sm">
                <p className="text-gray-500 mb-4">You haven't written any reviews yet.</p>
                <Link href="/" className="bg-indigo-600 text-white px-4 py-2 rounded hover:bg-indigo-500 text-sm">Write your first review</Link>
              </div>
            ) : (
              <div className="space-y-4">
                {user.reviews.map((review) => (
                  <div key={review.id} className="bg-white dark:bg-gray-800 p-5 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm hover:border-gray-300 dark:hover:border-gray-600 transition">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <h3 className="font-bold text-lg text-gray-900 dark:text-white">{review.faculty.name}</h3>
                        <p className="text-xs text-indigo-600 dark:text-indigo-400">{review.faculty.department}</p>
                      </div>
                      <div className={`text-xs px-2 py-1 rounded font-bold ${
                        review.status === "APPROVED" ? "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200" :
                        review.status === "REJECTED" ? "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200" :
                        "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200"
                      }`}>
                        {review.status}
                      </div>
                    </div>

                    <div className="flex items-center gap-2 mb-3 text-sm">
                      <span className="text-yellow-500 dark:text-yellow-400">{"‚òÖ".repeat(review.rating)}</span>
                      <span className="text-gray-500 text-xs">‚Ä¢ {new Date(review.createdAt).toLocaleDateString()}</span>
                    </div>

                    <p className="text-gray-700 dark:text-gray-300 text-sm mb-4 leading-relaxed">"{review.comment}"</p>

                    <div className="flex items-center gap-4 text-xs text-gray-500 dark:text-gray-400 border-t border-gray-100 dark:border-gray-700 pt-3">
                      <span>üëç {review.votes.filter(v => v.type === "UP").length} Upvotes</span>
                      <span>üëé {review.votes.filter(v => v.type === "DOWN").length} Downvotes</span>
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\register\page.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import toast from "react-hot-toast";
import { FaEye, FaEyeSlash } from "react-icons/fa"; 

export default function RegisterPage() {
  const [formData, setFormData] = useState({
    name: "",
    email: "",
    studentId: "",
    nickname: "",
    password: ""
  });
  const [loading, setLoading] = useState(false);
  const [showSuccessMessage, setShowSuccessMessage] = useState(false);
  
  
  const [showPassword, setShowPassword] = useState(false);
  
  const [errorMessages, setErrorMessages] = useState<string[]>([]); 
  const router = useRouter();

  const handleChange = (e: React.ChangeEvent<HTMLInputElement>) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
    if (errorMessages.length > 0) setErrorMessages([]);
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);
    setErrorMessages([]); 

    try {
      const res = await fetch("/api/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      let data;
      try {
        data = await res.json();
      } catch (err) {
        data = { errors: ["Something went wrong on the server."] };
      }

      if (res.ok) {
        toast.success("Registration successful!");
        setShowSuccessMessage(true);
      } else {
        if (data.errors && Array.isArray(data.errors)) {
          setErrorMessages(data.errors);
          toast.error(data.errors[0]); 
        } else if (data.error) {
           setErrorMessages([data.error]);
           toast.error(data.error);
        } else {
           setErrorMessages(["Registration failed."]);
        }
      }
    } catch (error) {
      setErrorMessages(["Network error. Please check your connection."]);
      toast.error("Something went wrong.");
    } finally {
      setLoading(false);
    }
  };

  if (showSuccessMessage) {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white p-4">
        <div className="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg text-center border border-gray-200 dark:border-gray-700 max-w-md w-full">
          <h2 className="text-2xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Check Your Email üìß</h2>
          <p className="text-gray-600 dark:text-gray-300 mb-6">
            We have sent a verification link to <strong>{formData.email}</strong>. 
            Please check your inbox (and spam folder).
          </p>
          <Link href="/login" className="text-indigo-600 hover:underline font-medium">
            Go to Login Page
          </Link>
        </div>
      </div>
    );
  }

  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-50 dark:bg-gray-900 px-4 py-12">
      <div className="w-full max-w-md space-y-6 bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700">
        <div className="text-center">
          <h2 className="text-3xl font-bold text-gray-900 dark:text-white">Create Account</h2>
          <p className="mt-2 text-sm text-gray-600 dark:text-gray-400">
            Join the community to review faculties anonymously
          </p>
        </div>

        {/* üîí Privacy Notice */}
        <div className="bg-indigo-50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-800 p-4 rounded-lg flex gap-3 text-left shadow-sm">
          <span className="text-xl">üîí</span>
          <div className="text-xs text-indigo-900 dark:text-indigo-200">
            <p className="font-bold mb-1">Your identity is hidden!</p>
            <p className="opacity-90 leading-relaxed">
              Your <span className="font-semibold">Name</span>, <span className="font-semibold">ID</span>, and <span className="font-semibold">Email</span> will remain completely <span className="font-bold underline">confidential</span>. 
              Only your <strong>Anonymous Name</strong> will be visible to others.
            </p>
          </div>
        </div>

        {/* ‚ö†Ô∏è Error Messages List */}
        {errorMessages.length > 0 && (
          <div className="bg-red-50 dark:bg-red-900/30 border border-red-200 dark:border-red-800 text-red-600 dark:text-red-300 p-4 rounded text-sm animate-pulse">
            <p className="font-bold mb-1">‚ö†Ô∏è Please fix the following:</p>
            <ul className="list-disc list-inside space-y-1">
              {errorMessages.map((msg, index) => (
                <li key={index}>{msg}</li>
              ))}
            </ul>
          </div>
        )}

        <form className="mt-4 space-y-4" onSubmit={handleSubmit}>
          <input name="name" type="text" required placeholder="Full Name  (Will be Hidden)" onChange={handleChange} className="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 outline-none focus:border-indigo-500 transition" />
          <input name="studentId" type="text" required placeholder="Student ID  (Will be Hidden)" onChange={handleChange} className="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 outline-none focus:border-indigo-500 transition" />
          
          <div className="relative">
            <input name="nickname" type="text" required placeholder="Anonymous Name (Visible to Public)" onChange={handleChange} className="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 border-2 border-indigo-100 dark:border-indigo-800 outline-none focus:border-indigo-500 transition" />
            <span className="absolute right-3 top-3.5 text-xs text-gray-400">Public</span>
          </div>

          <input name="email" type="email" required placeholder="Varsity Email  (Hidden)" onChange={handleChange} className="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 outline-none focus:border-indigo-500 transition" />
          
          {/* ‚úÖ ‡ß©. ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶á‡¶®‡¶™‡ßÅ‡¶ü ‡¶´‡¶ø‡¶≤‡ßç‡¶° ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (‡¶∂‡ßã/‡¶π‡¶æ‡¶á‡¶° ‡¶´‡¶ø‡¶ö‡¶æ‡¶∞ ‡¶∏‡¶π) */}
          <div className="relative">
            <input 
              name="password" 
              type={showPassword ? "text" : "password"} 
              required 
              placeholder="Password" 
              onChange={handleChange} 
              className="w-full p-3 rounded bg-gray-100 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 outline-none focus:border-indigo-500 transition pr-10" 
            />
            <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
              className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-indigo-600 dark:text-gray-400 transition"
            >
              {showPassword ? <FaEyeSlash size={18} /> : <FaEye size={18} />}
            </button>
          </div>

          <button type="submit" disabled={loading} className="w-full bg-indigo-600 text-white p-3 rounded font-bold hover:bg-indigo-500 disabled:opacity-50 transition shadow-lg shadow-indigo-500/30">
            {loading ? "Creating Account..." : "Sign Up Securely"}
          </button>
        </form>

        <div className="text-center text-sm">
          <span className="text-gray-600 dark:text-gray-400">Already have an account? </span>
          <Link href="/login" className="font-medium text-indigo-600 hover:text-indigo-500">Sign in</Link>
        </div>
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\reset-password\page.tsx
--------------------------------------------------
"use client";

import { useState, Suspense } from "react";
import { useRouter, useSearchParams } from "next/navigation";
import toast from "react-hot-toast";
import { FaEye, FaEyeSlash } from "react-icons/fa"; 

function ResetForm() {
  const searchParams = useSearchParams();
  const token = searchParams.get("token");
  
  const [password, setPassword] = useState("");
  const [showPassword, setShowPassword] = useState(false);
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    
    if (!token) {
      toast.error("Invalid or missing token.");
      return;
    }

    setLoading(true);

    try {
      const res = await fetch("/api/auth/reset-password", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ token, newPassword: password }),
      });

      const data = await res.json();

      if (res.ok) {
        toast.success("Password updated successfully! Please login.");
        router.push("/login");
      } else {
        toast.error(data.error || "Failed to reset password.");
      }
    } catch (error) {
      toast.error("Something went wrong.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="w-full max-w-md bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700">
      <h2 className="text-2xl font-bold mb-4 text-gray-900 dark:text-white text-center">Set New Password</h2>
      
      <form onSubmit={handleSubmit} className="space-y-4">
        <div>
          <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">New Password</label>
          
          
          <div className="relative">
            <input
              
              type={showPassword ? "text" : "password"} 
              placeholder="Enter strong password"
              required
              className="w-full p-3 border rounded-md dark:bg-gray-700 dark:border-gray-600 outline-none focus:border-indigo-500 transition pr-10" 
              value={password}
              onChange={(e) => setPassword(e.target.value)}
            />
            
           
            <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
              className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-indigo-600 dark:text-gray-400 transition"
            >
              {showPassword ? <FaEyeSlash size={18} /> : <FaEye size={18} />}
            </button>
          </div>

          <p className="text-xs text-gray-500 dark:text-gray-400 mt-2">
            Must contain: Min 8 chars, Uppercase (A-Z), Lowercase (a-z), Number (0-9) & Special Character (!@#).
          </p>
        </div>
        
        <button 
          disabled={loading} 
          className="w-full bg-indigo-600 text-white p-3 rounded font-bold hover:bg-indigo-700 transition disabled:opacity-50"
        >
          {loading ? "Updating Password..." : "Update Password"}
        </button>
      </form>
    </div>
  );
}

export default function ResetPasswordPage() {
  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-50 dark:bg-gray-900 px-4">
      <Suspense fallback={<div className="text-white">Loading...</div>}>
        <ResetForm />
      </Suspense>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\student\[userId]\page.tsx
--------------------------------------------------
// src/app/student/[userId]/page.tsx
import prisma from "@/lib/prisma";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import { notFound, redirect } from "next/navigation";
import Link from "next/link";
import UserBadge from "@/components/UserBadge"; 

interface Props {
  params: Promise<{ userId: string }>;
}

export default async function StudentProfilePage(props: Props) {
  const params = await props.params;
  const session = await getServerSession(authOptions);

  if (!session) {
    redirect("/login");
  }

  const profileUser = await prisma.user.findUnique({
    where: { 
      id: params.userId 
    }, 
    include: {
      reviews: {
        include: {
          faculty: true,
          votes: true,
        },
        orderBy: { createdAt: "desc" },
      },
    },
  });

  if (!profileUser) {
    return notFound();
  }

  const currentUser = await prisma.user.findUnique({
    where: { email: session.user?.email! },
  });

  const isAdmin = currentUser?.role === "ADMIN";
  const isOwnProfile = currentUser?.id === profileUser.id;
  const canViewSensitiveData = isAdmin || isOwnProfile;

  const reviewCount = profileUser.reviews.length;

  return (
    <div className="min-h-screen p-8 max-w-4xl mx-auto">
      <div className="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-200 dark:border-gray-700 p-8 mb-8">
        <div className="flex flex-col md:flex-row items-center gap-6">
          
          <div className="w-24 h-24 bg-indigo-100 dark:bg-indigo-900/50 rounded-full flex items-center justify-center text-4xl shadow-inner border-4 border-white dark:border-gray-700">
            ü§ñ
          </div>

          <div className="flex-1 text-center md:text-left space-y-2">
            
            <div className="flex flex-col md:flex-row items-center gap-3 justify-center md:justify-start">
              <h1 className="text-3xl font-bold text-gray-900 dark:text-white">
                @{profileUser.nickname || "Anonymous"}
              </h1>
              <UserBadge reviewCount={reviewCount} role={profileUser.role} />
            </div>

            <p className="text-indigo-600 dark:text-indigo-400 font-medium">
              {profileUser.role} &bull; Joined {new Date(profileUser.createdAt).toLocaleDateString()}
            </p>
            
            <div className="mt-4 bg-gray-50 dark:bg-gray-700/30 p-4 rounded-lg border border-gray-100 dark:border-gray-700">
              {canViewSensitiveData ? (
                <div className="space-y-2 text-sm">
                  {isAdmin && (
                    <span className="bg-red-100 text-red-800 text-xs font-bold px-2 py-0.5 rounded mb-2 inline-block">
                      ADMIN VIEW
                    </span>
                  )}
                  <p><span className="font-semibold text-gray-500">Full Name:</span> {profileUser.name}</p>
                  <p><span className="font-semibold text-gray-500">Student ID:</span> {profileUser.studentId}</p>
                  <p><span className="font-semibold text-gray-500">Email:</span> {profileUser.email}</p>
                </div>
              ) : (
                <div className="flex items-center gap-2 text-gray-500 italic text-sm justify-center md:justify-start">
                  <span>üîí Personal information is hidden.</span>
                </div>
              )}
            </div>
          </div>
        </div>
      </div>

      <div className="flex items-center justify-between mb-6 border-b border-gray-200 dark:border-gray-700 pb-2">
        <h2 className="text-2xl font-bold text-gray-800 dark:text-white">
          Reviews History
        </h2>
        <span className="bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-3 py-1 rounded-full text-sm font-bold">
          Total: {reviewCount}
        </span>
      </div>

      <div className="space-y-6">
        {profileUser.reviews.length === 0 ? (
          <div className="text-center py-10 bg-gray-50 dark:bg-gray-800 rounded-lg border border-dashed border-gray-300 dark:border-gray-700">
            <p className="text-gray-500">This user hasn't posted any reviews yet.</p>
          </div>
        ) : (
          profileUser.reviews.map((review) => (
            <div key={review.id} className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
              <div className="flex justify-between items-start mb-2">
                <Link href={`/faculty/${review.facultyId}`} className="hover:underline">
                  <h3 className="text-lg font-bold text-indigo-600 dark:text-indigo-400">
                    {review.faculty.name}
                  </h3>
                </Link>
                <span className="text-yellow-500 font-bold bg-yellow-50 dark:bg-yellow-900/20 px-2 py-1 rounded text-sm">
                  ‚òÖ {review.rating}/5
                </span>
              </div>
              
              <div className="mb-3">
                 <span className="text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 px-2 py-0.5 rounded">
                    Course: {review.course}
                 </span>
              </div>

              <p className="text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap">
                {review.comment}
              </p>
              
              <div className="mt-4 text-xs text-gray-400 border-t pt-3 dark:border-gray-700">
                Posted on {new Date(review.createdAt).toLocaleDateString()}
              </div>
            </div>
          ))
        )}
      </div>
      
      <div className="mt-8 text-center">
        <Link href="/" className="text-indigo-600 hover:underline font-medium">
          &larr; Back to Home
        </Link>
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\app\verify-email\page.tsx
--------------------------------------------------
"use client";

import { useSearchParams, useRouter } from "next/navigation";
import { useEffect, useState, Suspense } from "react";
import toast from "react-hot-toast";


function VerifyEmailContent() {
  const searchParams = useSearchParams();
  const token = searchParams.get("token");
  const router = useRouter();
  const [status, setStatus] = useState("Verifying your email...");

  useEffect(() => {
    if (!token) {
      setStatus("Invalid Token");
      return;
    }

    const verify = async () => {
      try {
        const res = await fetch("/api/auth/verify-email", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token }),
        });

        const data = await res.json();

        if (res.ok) {
          setStatus("‚úÖ Email Verified Successfully!");
          toast.success("Email verified! Redirecting to login...");
          setTimeout(() => router.push("/login"), 3000);
        } else {
          setStatus("‚ùå Verification Failed: " + data.error);
          toast.error(data.error);
        }
      } catch (error) {
        setStatus("‚ùå Something went wrong");
      }
    };

    verify();
  }, [token, router]);

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white p-4">
      <div className="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg text-center border border-gray-200 dark:border-gray-700 max-w-md w-full">
        <h1 className="text-2xl font-bold mb-4">{status}</h1>
        <p className="text-gray-500 text-sm">Please wait while we verify your token.</p>
      </div>
    </div>
  );
}


export default function VerifyEmailPage() {
  return (
    <Suspense fallback={<div className="min-h-screen flex items-center justify-center bg-gray-900 text-white">Loading verification...</div>}>
      <VerifyEmailContent />
    </Suspense>
  );
}


--------------------------------------------------
FILE: src\app\verify-email\VerifyEmailClient.tsx
--------------------------------------------------
"use client";

import { useSearchParams, useRouter } from "next/navigation";
import { useEffect, useState } from "react";
import toast from "react-hot-toast";

export default function VerifyEmailClient() {
  const searchParams = useSearchParams();
  const token = searchParams.get("token");
  const router = useRouter();
  const [status, setStatus] = useState("Verifying your email...");

  useEffect(() => {
    if (!token) {
      setStatus("Invalid Token");
      return;
    }

    const verify = async () => {
      try {
        const res = await fetch("/api/auth/verify-email", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ token }),
        });

        const data = await res.json();

        if (res.ok) {
          setStatus("‚úÖ Email Verified Successfully!");
          toast.success("Email verified! Redirecting to login...");
          setTimeout(() => router.push("/login"), 3000);
        } else {
          setStatus("‚ùå Verification Failed: " + data.error);
          toast.error(data.error);
        }
      } catch (error) {
        setStatus("‚ùå Something went wrong");
      }
    };

    verify();
  }, [token, router]);

  return (
    <div className="min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-white p-4">
      <div className="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-lg text-center border border-gray-200 dark:border-gray-700 max-w-md w-full">
        <h1 className="text-2xl font-bold mb-4">{status}</h1>
        <p className="text-gray-500 text-sm">Please wait while we verify your token.</p>
      </div>
    </div>
  );
}



--------------------------------------------------
FILE: src\app\verify-request\page.tsx
--------------------------------------------------
// src/app/verify-request/page.tsx

export default function VerifyRequestPage() {
  return (
    <div className="flex min-h-screen items-center justify-center bg-gray-900">
      <div className="w-full max-w-md p-8 space-y-4 bg-white rounded-lg shadow-md">
        <h1 className="text-2xl font-bold text-center text-gray-900">
          Check Your Email
        </h1>
        <p className="text-center text-gray-600">
          A magic link has been sent to your email address.
        </p>
        <p className="text-center text-sm text-gray-500">
          Please check your inbox (and spam folder) to sign in.
        </p>
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AddFacultyForm.tsx
--------------------------------------------------

"use client";

import { useState, useEffect } from "react";
import toast from "react-hot-toast";

export default function AddFacultyForm() {
  const [isOpen, setIsOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  
  
  const [departments, setDepartments] = useState<{ id: string; name: string }[]>([]);

  
  const [formData, setFormData] = useState({
    name: "",
    department: "",
    designation: "Lecturer",
    initial: "",
    code: ""
  });

  
  useEffect(() => {
    const fetchDepartments = async () => {
      try {
        const res = await fetch("/api/departments");
        if (res.ok) {
          const data = await res.json();
          setDepartments(data);
        }
      } catch (error) {
        console.error("Failed to load departments");
      }
    };

    
    if (isOpen) {
      fetchDepartments();
    }
  }, [isOpen]);

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {
    setFormData({ ...formData, [e.target.name]: e.target.value });
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const res = await fetch("/api/faculty", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });

      if (res.ok) {
        toast.success("Faculty added successfully!");
        setIsOpen(false);
        
        setFormData({ name: "", department: "", designation: "Lecturer", initial: "", code: "" });
        window.location.reload();
      } else {
        const data = await res.json();
        toast.error(data.error || "Failed to add faculty");
      }
    } catch (error) {
      toast.error("Something went wrong");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="w-full max-w-2xl mx-auto mb-8">
      {!isOpen ? (
        <button
          onClick={() => setIsOpen(true)}
          className="w-full py-3 bg-white dark:bg-gray-800 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg text-gray-500 hover:text-indigo-600 hover:border-indigo-400 transition font-bold"
        >
          + Add New Faculty
        </button>
      ) : (
        <div className="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700">
          <div className="flex justify-between items-center mb-4">
            <h2 className="text-xl font-bold text-gray-800 dark:text-white">Add Faculty</h2>
            <button onClick={() => setIsOpen(false)} className="text-gray-500 hover:text-red-500">‚úñ</button>
          </div>

          <form onSubmit={handleSubmit} className="space-y-4">
            
            <div>
              <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Faculty Name <span className="text-red-500">*</span></label>
              <input name="name" type="text" required placeholder="e.g. Dr. Abul Kashem" value={formData.name} onChange={handleChange} className="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" />
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              
              <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Department <span className="text-red-500">*</span></label>
                <select 
                  name="department" 
                  required 
                  value={formData.department} 
                  onChange={handleChange} 
                  className="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600"
                >
                  <option value="" disabled>Select Department</option>
                  
                  {departments.length === 0 ? (
                    <option disabled>Loading departments...</option>
                  ) : (
                    departments.map((dept) => (
                      <option key={dept.id} value={dept.name}>{dept.name}</option>
                    ))
                  )}
                </select>
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Designation</label>
                <select name="designation" value={formData.designation} onChange={handleChange} className="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600">
                  <option value="Vice Chancellor">Vice Chancellor</option>
                  <option value="Associate Professor">Associate Professor</option>
                  <option value="Assistant Professor">Assistant Professor</option>
                  <option value="Professor">Professor</option>
                  <option value="Lecturer">Lecturer</option>
                </select>
              </div>
            </div>

            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Initial (Optional)</label>
                <input name="initial" type="text" placeholder="e.g. MSA" value={formData.initial} onChange={handleChange} className="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" />
              </div>

              <div>
                <label className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">Code / Room (Optional)</label>
                <input name="code" type="text" placeholder="e.g. 1234" value={formData.code} onChange={handleChange} className="w-full p-2 border rounded dark:bg-gray-700 dark:border-gray-600" />
              </div>
            </div>

            <button type="submit" disabled={loading} className="w-full bg-indigo-600 text-white p-2 rounded hover:bg-indigo-700 disabled:opacity-50 font-bold">
              {loading ? "Adding..." : "Submit Faculty"}
            </button>
          </form>
        </div>
      )}
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AdminDashboardSections.tsx
--------------------------------------------------
//src/app/admin/page.tsx
"use client";

import { useState } from "react";
import AdminDepartmentManager from "@/components/AdminDepartmentManager";
import AdminStudentList from "@/components/AdminStudentList";
import AdminFacultyManager from "@/components/AdminFacultyManager";

interface Props {
  departments: any[];
  students: any[];
  faculties: any[];
}

export default function AdminDashboardSections({ departments, students, faculties }: Props) {
  // ‡¶ï‡¶®‡¶´‡¶ø‡¶ó‡¶æ‡¶∞‡ßá‡¶∂‡¶®: ‡¶∂‡ßÅ‡¶∞‡ßÅ‡¶§‡ßá ‡¶∏‡¶¨ ‡¶¨‡¶®‡ßç‡¶ß ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ("")‡•§
  const [activeSection, setActiveSection] = useState<string>("");

  const toggleSection = (section: string) => {
    setActiveSection(activeSection === section ? "" : section);
  };

  return (
    <div className="space-y-4 w-full">
      
      {/* ‡ßß. ‡¶°‡¶ø‡¶™‡¶æ‡¶∞‡ßç‡¶ü‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü */}
      <div className="glass-card overflow-hidden rounded-xl transition-all duration-300 border border-gray-200 dark:border-gray-800">
        <button
          onClick={() => toggleSection("dept")}
          className={`w-full flex justify-between items-center p-5 text-left transition-colors ${
            activeSection === "dept" ? "bg-indigo-50 dark:bg-indigo-900/20" : "hover:bg-gray-50 dark:hover:bg-gray-800/50"
          }`}
        >
          <div className="flex items-center gap-3">
            <span className="text-2xl">üè¢</span>
            <div>
              <h3 className="text-lg font-bold text-gray-800 dark:text-white">Department Management</h3>
              <p className="text-xs text-gray-500">Manage university departments</p>
            </div>
          </div>
          <span className={`text-xl transition-transform duration-300 ${activeSection === "dept" ? "rotate-180" : ""}`}>
            ‚ñº
          </span>
        </button>
        
        {activeSection === "dept" && (
          <div className="p-6 border-t border-gray-100 dark:border-gray-700 animate-fadeIn">
            <AdminDepartmentManager departments={departments} />
          </div>
        )}
      </div>

      {/* ‡ß®. ‡¶∏‡ßç‡¶ü‡ßÅ‡¶°‡ßá‡¶®‡ßç‡¶ü ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü */}
      <div className="glass-card overflow-hidden rounded-xl transition-all duration-300 border border-gray-200 dark:border-gray-800">
        <button
          onClick={() => toggleSection("student")}
          className={`w-full flex justify-between items-center p-5 text-left transition-colors ${
            activeSection === "student" ? "bg-indigo-50 dark:bg-indigo-900/20" : "hover:bg-gray-50 dark:hover:bg-gray-800/50"
          }`}
        >
          <div className="flex items-center gap-3">
             <span className="text-2xl">üë®‚Äçüéì</span>
             <div>
              <h3 className="text-lg font-bold text-gray-800 dark:text-white">Student / User Management</h3>
              <p className="text-xs text-gray-500">View and manage registered students</p>
            </div>
          </div>
          <span className={`text-xl transition-transform duration-300 ${activeSection === "student" ? "rotate-180" : ""}`}>
            ‚ñº
          </span>
        </button>
        
        {activeSection === "student" && (
          <div className="p-6 border-t border-gray-100 dark:border-gray-700 animate-fadeIn">
            <AdminStudentList students={students} />
          </div>
        )}
      </div>

      {/* ‡ß©. ‡¶´‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶≤‡ßç‡¶ü‡¶ø ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶ú‡¶Æ‡ßá‡¶®‡ßç‡¶ü */}
      <div className="glass-card overflow-hidden rounded-xl transition-all duration-300 border border-gray-200 dark:border-gray-800">
        <button
          onClick={() => toggleSection("faculty")}
          className={`w-full flex justify-between items-center p-5 text-left transition-colors ${
            activeSection === "faculty" ? "bg-indigo-50 dark:bg-indigo-900/20" : "hover:bg-gray-50 dark:hover:bg-gray-800/50"
          }`}
        >
          <div className="flex items-center gap-3">
             <span className="text-2xl">üë®‚Äçüè´</span>
             <div>
              <h3 className="text-lg font-bold text-gray-800 dark:text-white">Faculty Database</h3>
              <p className="text-xs text-gray-500">Add, edit, and bulk update faculties</p>
            </div>
          </div>
          <span className={`text-xl transition-transform duration-300 ${activeSection === "faculty" ? "rotate-180" : ""}`}>
            ‚ñº
          </span>
        </button>
        
        {activeSection === "faculty" && (
          <div className="p-6 border-t border-gray-100 dark:border-gray-700 animate-fadeIn">
            <AdminFacultyManager faculties={faculties} departments={departments} />
          </div>
        )}
      </div>

    </div>
  );
}


--------------------------------------------------
FILE: src\components\AdminDepartmentManager.tsx
--------------------------------------------------
// src/components/AdminDepartmentManager.tsx
"use client";

import { useState } from "react";
import toast from "react-hot-toast";
import { useRouter } from "next/navigation";

export default function AdminDepartmentManager({ departments }: { departments: any[] }) {
  const [name, setName] = useState("");
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleAdd = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!name.trim()) return;
    setLoading(true);

    const res = await fetch("/api/admin/department", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ name }),
    });

    setLoading(false);
    if (res.ok) {
      toast.success("Department Added!");
      setName("");
      router.refresh();
    } else {
      toast.error("Failed or already exists!");
    }
  };

  const handleDelete = async (id: string) => {
    if (!confirm("Delete this department?")) return;
    const res = await fetch("/api/admin/department", {
      method: "DELETE",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ id }),
    });

    if (res.ok) {
      toast.success("Deleted!");
      router.refresh();
    } else {
      toast.error("Failed!");
    }
  };

  return (
    <div className="bg-white dark:bg-gray-800 p-6 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm">
      <h2 className="text-xl font-bold mb-4 text-indigo-600 dark:text-indigo-400">Manage Departments</h2>

      <form onSubmit={handleAdd} className="flex gap-2 mb-6">
        <input
          type="text"
          value={name}
          onChange={(e) => setName(e.target.value)}
          placeholder="New Dept (e.g. CSE)"
          className="flex-1 bg-gray-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600 p-2 rounded text-sm outline-none text-gray-900 dark:text-white"
        />
        <button 
          type="submit" 
          disabled={loading}
          className="bg-indigo-600 text-white px-4 py-2 rounded text-sm hover:bg-indigo-500 disabled:opacity-50"
        >
          {loading ? "Adding..." : "Add"}
        </button>
      </form>

      <div className="flex flex-wrap gap-2">
        {departments.length === 0 && <p className="text-gray-500 text-sm">No departments added yet.</p>}
        
        {departments.map((dept) => (
          <div key={dept.id} className="bg-gray-100 dark:bg-gray-700 px-3 py-1 rounded-full flex items-center gap-2 border border-gray-200 dark:border-gray-600">
            <span className="font-bold text-sm text-gray-800 dark:text-gray-200">{dept.name}</span>
            <button 
              onClick={() => handleDelete(dept.id)}
              className="text-red-500 hover:text-red-700 font-bold text-xs"
            >
              ‚úï
            </button>
          </div>
        ))}
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AdminFacultyControls.tsx
--------------------------------------------------
// src/components/AdminFacultyControls.tsx
"use client";
import { useRouter } from "next/navigation";
import { useState } from "react";

export default function AdminFacultyControls({ facultyId }: { facultyId: string }) {
  const router = useRouter();
  const [loading, setLoading] = useState(false);

  const handleAction = async (action: "approve" | "reject") => {
    setLoading(true);
    await fetch("/api/admin/faculty", {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ facultyId, action }),
    });
    setLoading(false);
    router.refresh();
  };

  return (
    <div className="flex gap-2 mt-2">
      <button onClick={() => handleAction("approve")} disabled={loading} className="bg-green-600 text-white px-3 py-1 rounded text-xs hover:bg-green-500">
        {loading ? "..." : "Approve Faculty"}
      </button>
      <button onClick={() => handleAction("reject")} disabled={loading} className="bg-red-600 text-white px-3 py-1 rounded text-xs hover:bg-red-500">
        {loading ? "..." : "Reject & Delete"}
      </button>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AdminFacultyList.tsx
--------------------------------------------------
// src/components/AdminFacultyList.tsx
"use client";

import { useState } from "react";
import toast from "react-hot-toast";
import { useRouter } from "next/navigation";
import Link from "next/link";

export default function AdminFacultyList({ faculties }: { faculties: any[] }) {
  const [search, setSearch] = useState("");
  const [loadingId, setLoadingId] = useState<string | null>(null);
  const router = useRouter();

  const filteredFaculties = faculties.filter(f => 
    f.name.toLowerCase().includes(search.toLowerCase()) ||
    f.department.toLowerCase().includes(search.toLowerCase())
  );

  const handleDelete = async (facultyId: string) => {
    if (!confirm("‚ö†Ô∏è Warning! This will delete the faculty and ALL reviews associated with them.")) return;
    
    setLoadingId(facultyId);
    const res = await fetch("/api/admin/faculty", {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ facultyId, action: "reject" }),
    });

    setLoadingId(null);
    if (res.ok) {
      toast.success("Faculty deleted!");
      router.refresh();
    } else {
      toast.error("Failed to delete faculty");
    }
  };

  return (
    <div className="bg-gray-800 p-6 rounded-lg border border-gray-700 mt-8">
      <div className="flex justify-between items-center mb-4">
        <h2 className="text-xl font-bold text-yellow-300">Manage Faculties ({faculties.length})</h2>
        <input 
          type="text" 
          placeholder="Search faculty..." 
          className="bg-gray-900 border border-gray-600 p-2 rounded text-sm text-white w-64"
          onChange={(e) => setSearch(e.target.value)}
        />
      </div>

      <div className="grid gap-2 max-h-96 overflow-y-auto custom-scrollbar">
        {filteredFaculties.map((faculty) => (
          <div key={faculty.id} className="flex justify-between items-center bg-gray-900 p-3 rounded border border-gray-700 hover:bg-gray-700/50">
            <div>
              <Link href={`/faculty/${faculty.id}`}>
              <h3 className="font-bold text-white">{faculty.name}</h3>
            </Link>



              <p className="text-xs text-gray-400">{faculty.department} ‚Ä¢ {faculty.reviews.length} Reviews</p>
            </div>
            <button 
              onClick={() => handleDelete(faculty.id)}
              disabled={loadingId === faculty.id}
              className="bg-red-900/50 text-red-200 border border-red-800 px-3 py-1 rounded text-xs hover:bg-red-800 transition"
            >
              {loadingId === faculty.id ? "..." : "Delete"}
            </button>
          </div>
        ))}
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AdminFacultyManager.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import toast from "react-hot-toast";

interface Props {
  faculties: any[];
  departments: any[];
}

export default function AdminFacultyManager({ faculties, departments }: Props) {
  const router = useRouter();
  
  // ‡¶∏‡ßç‡¶ü‡ßá‡¶ü‡¶∏ (States)
  const [selectedIds, setSelectedIds] = useState<string[]>([]); // ‡¶ö‡ßá‡¶ï‡¶¨‡¶ï‡ßç‡¶∏‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
  const [searchTerm, setSearchTerm] = useState(""); // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
  const [editingFaculty, setEditingFaculty] = useState<any | null>(null); // ‡¶è‡¶°‡¶ø‡¶ü ‡¶Æ‡¶°‡¶æ‡¶≤‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
  const [targetDept, setTargetDept] = useState(""); // ‡¶¨‡¶æ‡¶≤‡ßç‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
  const [isUpdating, setIsUpdating] = useState(false); // ‡¶≤‡ßã‡¶°‡¶ø‡¶Ç ‡¶á‡¶®‡ßç‡¶°‡¶ø‡¶ï‡ßá‡¶ü‡¶∞

  // üîç ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞
  const filteredFaculties = faculties.filter(f => 
    f.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
    f.department.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // ‚úÖ ‡¶∏‡¶¨ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
  const handleSelectAll = (e: any) => {
    if (e.target.checked) setSelectedIds(filteredFaculties.map(f => f.id));
    else setSelectedIds([]);
  };

  // ‚úÖ ‡¶è‡¶ï‡¶ü‡¶æ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
  const handleSelectOne = (id: string) => {
    if (selectedIds.includes(id)) setSelectedIds(selectedIds.filter(sid => sid !== id));
    else setSelectedIds([...selectedIds, id]);
  };

  // ‚ö° ‡¶¨‡¶æ‡¶≤‡ßç‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü (‡¶è‡¶ï‡¶∏‡¶æ‡¶•‡ßá ‡¶Ö‡¶®‡ßá‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã)
  const handleBulkUpdate = async () => {
    if (!targetDept) return toast.error("Select a department first");
    setIsUpdating(true);
    try {
      await fetch("/api/faculty/bulk", {
        method: "PATCH",
        body: JSON.stringify({ ids: selectedIds, data: { department: targetDept } }),
      });
      toast.success(`Updated ${selectedIds.length} faculties!`);
      setSelectedIds([]); // ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡¶∂‡¶® ‡¶ï‡ßç‡¶≤‡¶ø‡ßü‡¶æ‡¶∞
      router.refresh(); // ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂
    } catch { toast.error("Failed to update"); }
    setIsUpdating(false);
  };

  // üóëÔ∏è ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶≤‡¶ú‡¶ø‡¶ï
  const handleDelete = async (id: string) => {
    if(!confirm("Are you sure you want to delete?")) return;
    try {
      await fetch(`/api/faculty/${id}`, { method: "DELETE" });
      toast.success("Deleted successfully!");
      router.refresh();
    } catch { toast.error("Failed to delete"); }
  };

  return (
    <div className="w-full space-y-4">
      
      {/* üõ†Ô∏è ‡¶â‡¶™‡¶∞‡ßá‡¶∞ ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶¨‡¶æ‡¶∞ */}
      <div className="flex flex-col md:flex-row justify-between gap-4 bg-white dark:bg-gray-800 p-4 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm">
        <input 
          type="text" 
          placeholder="üîç Search faculty..." 
          className="px-4 py-2 rounded-lg border dark:bg-gray-700 dark:border-gray-600 w-full md:w-1/3 outline-none"
          onChange={(e) => setSearchTerm(e.target.value)}
        />

        {/* ‡¶¨‡¶æ‡¶≤‡ßç‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶¨‡¶æ‡¶ü‡¶® (‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá) */}
        {selectedIds.length > 0 && (
          <div className="flex items-center gap-2 animate-fadeIn">
            <span className="text-sm font-bold text-indigo-600">{selectedIds.length} selected</span>
            <select 
              className="p-2 rounded border text-sm dark:bg-gray-700"
              onChange={(e) => setTargetDept(e.target.value)}
            >
              <option value="">Select Dept...</option>
              {departments.map((d: any) => <option key={d.id} value={d.name}>{d.name}</option>)}
            </select>
            <button 
              onClick={handleBulkUpdate} 
              disabled={isUpdating}
              className="bg-indigo-600 text-white px-4 py-2 rounded text-sm hover:bg-indigo-700"
            >
              {isUpdating ? "..." : "Update All"}
            </button>
          </div>
        )}
      </div>

      {/* üìä ‡¶Æ‡ßá‡¶á‡¶® ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ */}
      <div className="bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 overflow-hidden">
        <div className="overflow-x-auto max-h-[600px] custom-scrollbar">
          <table className="w-full text-left border-collapse">
            <thead className="bg-gray-50 dark:bg-gray-700/50 sticky top-0 z-10">
              <tr className="text-xs uppercase text-gray-500 font-bold">
                <th className="p-4 w-10">
                  <input type="checkbox" onChange={handleSelectAll} checked={selectedIds.length === filteredFaculties.length && filteredFaculties.length > 0} />
                </th>
                <th className="p-4">Faculty Name</th>
                <th className="p-4">Department</th>
                <th className="p-4 text-right">Actions</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-gray-100 dark:divide-gray-700">
              {filteredFaculties.map((faculty) => (
                <tr key={faculty.id} className={`hover:bg-gray-50 dark:hover:bg-gray-700/30 transition ${selectedIds.includes(faculty.id) ? 'bg-indigo-50 dark:bg-indigo-900/20' : ''}`}>
                  <td className="p-4">
                    <input type="checkbox" checked={selectedIds.includes(faculty.id)} onChange={() => handleSelectOne(faculty.id)} />
                  </td>
                  <td className="p-4">
                    <div className="font-bold text-gray-900 dark:text-white">{faculty.name}</div>
                    <div className="text-xs text-gray-400">{faculty.designation || "N/A"}</div>
                  </td>
                  <td className="p-4">
                    <span className={`px-2 py-1 rounded text-xs font-bold ${faculty.department === 'GENERAL' ? 'bg-yellow-100 text-yellow-800' : 'bg-gray-100 dark:bg-gray-600 dark:text-gray-200'}`}>
                      {faculty.department}
                    </span>
                  </td>
                  <td className="p-4 text-right flex justify-end gap-2">
                    <button 
                      onClick={() => setEditingFaculty(faculty)} 
                      className="px-3 py-1 text-xs bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200"
                    >
                      Edit
                    </button>
                    <button 
                      onClick={() => handleDelete(faculty.id)}
                      className="px-3 py-1 text-xs bg-red-100 text-red-700 rounded hover:bg-red-200"
                    >
                      Delete
                    </button>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      {/* ‚úèÔ∏è ‡¶è‡¶°‡¶ø‡¶ü ‡¶™‡¶™‡¶Ü‡¶™ ‡¶Æ‡¶°‡¶æ‡¶≤ (‡¶®‡¶ø‡¶ö‡ßá ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶ï‡¶Æ‡ßç‡¶™‡ßã‡¶®‡ßá‡¶®‡ßç‡¶ü ‡¶π‡¶ø‡¶∏‡ßá‡¶¨‡ßá ‡¶ï‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá) */}
      {editingFaculty && (
        <EditModal 
          faculty={editingFaculty} 
          departments={departments} 
          onClose={() => setEditingFaculty(null)} 
        />
      )}
    </div>
  );
}

// üëá ‡¶Æ‡¶°‡¶æ‡¶≤ ‡¶ï‡¶Æ‡ßç‡¶™‡ßã‡¶®‡ßá‡¶®‡ßç‡¶ü (‡¶è‡¶ï‡¶á ‡¶´‡¶æ‡¶á‡¶≤‡ßá ‡¶∞‡¶æ‡¶ñ‡¶æ ‡¶π‡¶≤‡ßã ‡¶Ø‡¶æ‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßÅ‡¶¨‡¶ø‡¶ß‡¶æ ‡¶π‡ßü)
function EditModal({ faculty, departments, onClose }: any) {
  const router = useRouter();
  const [formData, setFormData] = useState({ ...faculty });
  const [saving, setSaving] = useState(false);

  const handleSave = async (e: any) => {
    e.preventDefault();
    setSaving(true);
    try {
      await fetch(`/api/faculty/${faculty.id}`, {
        method: "PATCH",
        body: JSON.stringify(formData),
      });
      toast.success("Updated Successfully!");
      router.refresh();
      onClose();
    } catch { toast.error("Failed to update"); }
    setSaving(false);
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in">
      <div className="bg-white dark:bg-gray-900 w-full max-w-md rounded-2xl p-6 shadow-2xl border border-gray-200 dark:border-gray-700">
        <h2 className="text-xl font-bold mb-4 dark:text-white">Edit Faculty Details</h2>
        <form onSubmit={handleSave} className="space-y-3">
          
          <div>
            <label className="text-xs font-bold text-gray-500 uppercase">Name</label>
            <input className="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-700" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} required />
          </div>

          <div className="grid grid-cols-2 gap-3">
             <div>
                <label className="text-xs font-bold text-gray-500 uppercase">Department</label>
                <select className="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-700" value={formData.department} onChange={e => setFormData({...formData, department: e.target.value})}>
                  {departments.map((d: any) => <option key={d.id} value={d.name}>{d.name}</option>)}
                </select>
             </div>
             <div>
                <label className="text-xs font-bold text-gray-500 uppercase">Designation</label>
                <input className="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-700" value={formData.designation || ""} onChange={e => setFormData({...formData, designation: e.target.value})} />
             </div>
          </div>

          <div>
            <label className="text-xs font-bold text-gray-500 uppercase">Email</label>
            <input className="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-700" value={formData.email || ""} onChange={e => setFormData({...formData, email: e.target.value})} />
          </div>

          <div>
            <label className="text-xs font-bold text-gray-500 uppercase">Image URL</label>
            <input className="w-full p-2 border rounded dark:bg-gray-800 dark:border-gray-700" value={formData.image || ""} onChange={e => setFormData({...formData, image: e.target.value})} />
          </div>

          <div className="flex justify-end gap-2 mt-6 pt-4 border-t dark:border-gray-700">
            <button type="button" onClick={onClose} className="px-4 py-2 text-gray-500 hover:bg-gray-100 rounded">Cancel</button>
            <button type="submit" disabled={saving} className="px-4 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700">
              {saving ? "Saving..." : "Save Changes"}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AdminReportControls.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import toast from "react-hot-toast";
import AdminReviewDeleteButton from "./AdminReviewDeleteButton"; 

interface Props {
  reviewId: string;
}

export default function AdminReportControls({ reviewId }: Props) {
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleDismiss = async () => {
    setLoading(true);
    try {
      const res = await fetch("/api/admin/report/dismiss", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ reviewId }),
      });

      if (res.ok) {
        toast.success("Report dismissed! Review kept. ‚úÖ");
        router.refresh();
      } else {
        toast.error("Failed to dismiss.");
      }
    } catch (error) {
      toast.error("Error occurred.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="flex gap-3 items-center mt-2">
      <div title="Delete Review & Warn User">
        <AdminReviewDeleteButton reviewId={reviewId} />
      </div>
      
      <button
        onClick={handleDismiss}
        disabled={loading}
        className="text-xs bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 px-3 py-1 rounded text-gray-700 dark:text-gray-300 font-bold transition"
        title="Ignore report and keep the review"
      >
        {loading ? "..." : "Dismiss Report"}
      </button>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AdminReviewControls.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import toast from "react-hot-toast";

interface Props { 
  reviewId: string;
}

export default function AdminReviewControls({ pendingReviews }: { pendingReviews: any }) {
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  // ‚úÖ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶ü‡¶æ‡¶á‡¶™ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã (‡¶õ‡ßã‡¶ü ‡¶π‡¶æ‡¶§‡ßá‡¶∞ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞‡ßá)
  const handleAction = async (action: "approve" | "reject") => {
    setLoading(true);
    try {
      const res = await fetch("/api/admin/review/action", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        // ‚úÖ ‡¶õ‡ßã‡¶ü ‡¶π‡¶æ‡¶§‡ßá‡¶∞ ‡¶Ö‡¶ï‡ßç‡¶∑‡¶∞ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá, ‡¶Ø‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï‡¶è‡¶®‡ßç‡¶°‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Æ‡¶ø‡¶≤‡¶¨‡ßá
        body: JSON.stringify({ reviewId, action }),
      });

      if (res.ok) {
        toast.success(action === "approve" ? "Review Approved! ‚úÖ" : "Review Rejected! ‚ùå");
        
        // ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Ü‡¶®‡¶¨‡ßá
        router.refresh(); 
      } else {
        toast.error("Failed to update status.");
      }
    } catch (error) {
      toast.error("Something went wrong.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="flex gap-2">
      <button
        // ‚úÖ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø ‡¶ï‡¶∞‡ßÅ‡¶®: "approve" (‡¶õ‡ßã‡¶ü ‡¶π‡¶æ‡¶§‡ßá‡¶∞)
        onClick={() => handleAction("approve")}
        disabled={loading}
        className="bg-green-100 hover:bg-green-200 text-green-700 px-3 py-1 rounded text-xs font-bold transition"
        title="Approve Review"
      >
        {loading ? "..." : "‚úÖ Approve"}
      </button>
      
      <button
        // ‚úÖ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ï‡ßç‡¶∑‡ßç‡¶Ø ‡¶ï‡¶∞‡ßÅ‡¶®: "reject" (‡¶õ‡ßã‡¶ü ‡¶π‡¶æ‡¶§‡ßá‡¶∞)
        onClick={() => handleAction("reject")}
        disabled={loading}
        className="bg-red-100 hover:bg-red-200 text-red-700 px-3 py-1 rounded text-xs font-bold transition"
        title="Reject & Delete"
      >
        {loading ? "..." : "‚ùå Reject"}
      </button>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AdminReviewDeleteButton.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import toast from "react-hot-toast";
import { useRouter } from "next/navigation";

interface Props {
  reviewId: string;
}

export default function AdminReviewDeleteButton({ reviewId }: Props) {
  const [isOpen, setIsOpen] = useState(false);
  const [loading, setLoading] = useState(false);
  const [warningReason, setWarningReason] = useState("");
  const router = useRouter();

  
  const handleDelete = async (withWarning: boolean) => {
    setLoading(true);
    try {
      const res = await fetch("/api/admin/review/delete", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ 
          reviewId, 
          withWarning, 
          warningReason: withWarning ? warningReason : null 
        }),
      });

      if (res.ok) {
        toast.success(withWarning ? "Deleted & User Warned! ‚ö†Ô∏è" : "Review Deleted! üóëÔ∏è");
        setIsOpen(false);
        router.refresh(); 
      } else {
        toast.error("Failed to delete.");
      }
    } catch (error) {
      toast.error("Something went wrong.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <>
      <button
        onClick={() => setIsOpen(true)}
        className="text-gray-400 hover:text-red-500 transition p-1 rounded-full hover:bg-red-50 dark:hover:bg-red-900/20"
        title="Delete Review (Admin)"
      >
        üóëÔ∏è
      </button>

      {isOpen && (
        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4">
          <div className="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-2xl w-full max-w-md border border-gray-200 dark:border-gray-700 animation-fade-in-up">
            
            <h3 className="text-xl font-bold text-red-600 dark:text-red-400 mb-2">Delete Review?</h3>
            <p className="text-gray-600 dark:text-gray-300 text-sm mb-4">
              This action cannot be undone. How would you like to proceed?
            </p>

            <div className="mb-4">
              <label className="text-xs font-semibold text-gray-500 uppercase">Warning Reason (Optional)</label>
              <textarea
                className="w-full mt-1 p-2 border rounded-lg text-sm dark:bg-gray-700 dark:border-gray-600 outline-none focus:border-red-500"
                rows={2}
                placeholder="e.g. Inappropriate language used..."
                value={warningReason}
                onChange={(e) => setWarningReason(e.target.value)}
              />
            </div>

            <div className="flex flex-col gap-2">
              
              <button
                onClick={() => handleDelete(true)}
                disabled={loading}
                className="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded-lg font-bold text-sm transition flex items-center justify-center gap-2"
              >
                {loading ? "Processing..." : "‚ö†Ô∏è Delete & Warn User"}
              </button>

              <button
                onClick={() => handleDelete(false)}
                disabled={loading}
                className="w-full bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 py-2 rounded-lg font-semibold text-sm transition"
              >
                Just Delete Review
              </button>

              <button
                onClick={() => setIsOpen(false)}
                className="mt-2 text-gray-500 hover:text-gray-700 dark:hover:text-gray-400 text-sm underline"
              >
                Cancel
              </button>
            </div>

          </div>
        </div>
      )}
    </>
  );
}


--------------------------------------------------
FILE: src\components\AdminSmartFacultyTable.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import toast from "react-hot-toast";

interface Props {
  faculties: any[];
  departments: any[];
}

export default function AdminSmartFacultyTable({ faculties, departments }: Props) {
  const router = useRouter();
  const [selectedIds, setSelectedIds] = useState<string[]>([]);
  const [targetDept, setTargetDept] = useState("");
  const [searchTerm, setSearchTerm] = useState("");
  const [isUpdating, setIsUpdating] = useState(false);

  // ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶´‡¶ø‡¶≤‡ßç‡¶ü‡¶æ‡¶∞
  const filteredFaculties = faculties.filter((f) =>
    f.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
    f.department.toLowerCase().includes(searchTerm.toLowerCase())
  );

  // ‡¶ö‡ßá‡¶ï‡¶¨‡¶æ‡¶ï‡ßç‡¶∏ ‡¶≤‡¶ú‡¶ø‡¶ï
  const handleSelectAll = (e: React.ChangeEvent<HTMLInputElement>) => {
    if (e.target.checked) {
      setSelectedIds(filteredFaculties.map((f) => f.id));
    } else {
      setSelectedIds([]);
    }
  };

  const handleSelectOne = (id: string) => {
    if (selectedIds.includes(id)) {
      setSelectedIds(selectedIds.filter((sid) => sid !== id));
    } else {
      setSelectedIds([...selectedIds, id]);
    }
  };

  // ‡¶¨‡¶æ‡¶≤‡ßç‡¶ï ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
  const handleBulkUpdate = async () => {
    if (!targetDept) return toast.error("Please select a department");
    setIsUpdating(true);

    try {
      const res = await fetch("/api/faculty/bulk", {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          ids: selectedIds,
          data: { department: targetDept },
        }),
      });

      if (res.ok) {
        toast.success(`Successfully updated ${selectedIds.length} faculties!`);
        setSelectedIds([]);
        router.refresh(); // ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶°‡¶æ‡¶ü‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá
      } else {
        toast.error("Failed to update");
      }
    } catch (error) {
      toast.error("Something went wrong");
    } finally {
      setIsUpdating(false);
    }
  };

  return (
    <div className="w-full">
      {/* ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶¨‡¶æ‡¶∞ ‡¶è‡¶¨‡¶Ç ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö */}
      <div className="flex flex-col md:flex-row justify-between items-center mb-4 gap-4">
        
        {/* ‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶¨‡¶ï‡ßç‡¶∏ */}
        <input
          type="text"
          placeholder="üîç Search faculty..."
          className="w-full md:w-64 px-4 py-2 rounded-lg border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-800 text-sm focus:ring-2 focus:ring-indigo-500 outline-none"
          value={searchTerm}
          onChange={(e) => setSearchTerm(e.target.value)}
        />

        {/* ‡¶¨‡¶æ‡¶≤‡ßç‡¶ï ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶∂‡¶® ‡¶ü‡ßÅ‡¶≤‡¶¨‡¶æ‡¶∞ (‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶Ø‡¶ñ‡¶® ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶§‡¶ñ‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá) */}
        {selectedIds.length > 0 && (
          <div className="flex items-center gap-2 bg-indigo-50 dark:bg-indigo-900/20 p-2 rounded-lg border border-indigo-100 dark:border-indigo-800 animate-in fade-in slide-in-from-top-2">
            <span className="text-xs font-bold text-indigo-700 dark:text-indigo-300 whitespace-nowrap px-2">
              {selectedIds.length} selected
            </span>
            
            <select
              value={targetDept}
              onChange={(e) => setTargetDept(e.target.value)}
              className="text-sm border-gray-300 rounded-md p-1.5 dark:bg-gray-800 dark:border-gray-600"
            >
              <option value="">Move to Dept...</option>
              {departments.map((d: any) => (
                <option key={d.id} value={d.name}>{d.name}</option>
              ))}
            </select>

            <button
              onClick={handleBulkUpdate}
              disabled={isUpdating}
              className="bg-indigo-600 text-white text-sm px-3 py-1.5 rounded-md hover:bg-indigo-700 disabled:opacity-50 transition"
            >
              {isUpdating ? "Updating..." : "Update"}
            </button>
          </div>
        )}
      </div>

      {/* ‡¶ü‡ßá‡¶¨‡¶ø‡¶≤ */}
      <div className="overflow-x-auto max-h-[500px] custom-scrollbar border border-gray-200 dark:border-gray-800 rounded-xl">
        <table className="w-full text-left border-collapse">
          <thead className="bg-gray-50 dark:bg-gray-800/50 sticky top-0 z-10">
            <tr className="text-xs font-bold text-gray-500 uppercase tracking-wider">
              <th className="p-4 w-10">
                <input
                  type="checkbox"
                  onChange={handleSelectAll}
                  checked={selectedIds.length === filteredFaculties.length && filteredFaculties.length > 0}
                  className="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                />
              </th>
              <th className="p-4">Name</th>
              <th className="p-4">Current Dept</th>
              <th className="p-4 text-right">Actions</th>
            </tr>
          </thead>
          <tbody className="divide-y divide-gray-100 dark:divide-gray-800">
            {filteredFaculties.length === 0 ? (
               <tr>
                 <td colSpan={4} className="p-8 text-center text-gray-400">No faculty found.</td>
               </tr>
            ) : (
              filteredFaculties.map((faculty) => (
                <tr
                  key={faculty.id}
                  className={`hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors ${
                    selectedIds.includes(faculty.id) ? "bg-indigo-50/50 dark:bg-indigo-900/10" : ""
                  }`}
                >
                  <td className="p-4">
                    <input
                      type="checkbox"
                      checked={selectedIds.includes(faculty.id)}
                      onChange={() => handleSelectOne(faculty.id)}
                      className="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"
                    />
                  </td>
                  <td className="p-4">
                    <div className="font-medium text-gray-900 dark:text-white">{faculty.name}</div>
                    <div className="text-xs text-gray-500">{faculty.designation || "Faculty"}</div>
                  </td>
                  <td className="p-4">
                    <span
                      className={`px-2 py-1 rounded-full text-xs font-bold ${
                        faculty.department === "GENERAL"
                          ? "bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400"
                          : "bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-300"
                      }`}
                    >
                      {faculty.department}
                    </span>
                  </td>
                  <td className="p-4 text-right">
                    {/* ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶è‡¶°‡¶ø‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶® */}
                    <button className="text-xs text-indigo-600 dark:text-indigo-400 hover:underline">
                      Edit
                    </button>
                  </td>
                </tr>
              ))
            )}
          </tbody>
        </table>
      </div>
      <div className="p-2 text-xs text-gray-400 text-right">
        Showing {filteredFaculties.length} entries
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AdminStudentList.tsx
--------------------------------------------------

"use client";

import { useState } from "react";
import toast from "react-hot-toast";
import { useRouter } from "next/navigation";
import Link from "next/link";


export default function AdminStudentList({ students }: { students: any[] }) {
  const [search, setSearch] = useState("");
  const [loadingId, setLoadingId] = useState<string | null>(null);
  const router = useRouter();

  
  const filteredStudents = students.filter(s => 
    s.email?.toLowerCase().includes(search.toLowerCase()) ||
    s.nickname?.toLowerCase().includes(search.toLowerCase())
  );

  const handleDelete = async (userId: string) => {
    if (!confirm("‚ö†Ô∏è Are you sure? This will delete the student and ALL their reviews/votes!")) return;
    
    setLoadingId(userId);
    const res = await fetch("/api/admin/user", {
      method: "DELETE",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ userId }),
    });

    setLoadingId(null);
    if (res.ok) {
      toast.success("Student deleted/banned!");
      router.refresh();
    } else {
      toast.error("Failed to delete student");
    }
  };

  return (
    <div className="bg-gray-800 p-6 rounded-lg border border-gray-700">
      <div className="flex justify-between items-center mb-4">
        <h2 className="text-xl font-bold text-indigo-300">Manage Students ({students.length})</h2>
        <input 
          type="text" 
          placeholder="Search email or nickname..." 
          className="bg-gray-900 border border-gray-600 p-2 rounded text-sm text-white w-64"
          onChange={(e) => setSearch(e.target.value)}
        />
      </div>

      <div className="overflow-x-auto">
        <table className="w-full text-left text-sm text-gray-400">
          <thead className="bg-gray-900 text-gray-200 uppercase text-xs">
            <tr>
              <th className="px-4 py-3">Nickname</th>
              <th className="px-4 py-3">Email</th>
              <th className="px-4 py-3">Reviews</th>
              <th className="px-4 py-3">Joined</th>
              <th className="px-4 py-3">Action</th>
            </tr>
          </thead>
          <tbody>
            {filteredStudents.slice(0, 10).map((student) => ( 
              <tr key={student.id} className="border-b border-gray-700 hover:bg-gray-700/50">
                <td className="px-4 py-3 text-white font-bold">
                  <Link href={`/student/${student.id}`}>
                      @{student.nickname || "Anon"}
                  </Link>
                </td>                 
                <td className="px-4 py-3">{student.email}</td>
                <td className="px-4 py-3">{student.reviews.length}</td>
                <td className="px-4 py-3">{new Date(student.createdAt).toLocaleDateString()}</td>
                <td className="px-4 py-3">
                  {student.role !== "ADMIN" && (
                    <button 
                      onClick={() => handleDelete(student.id)}
                      disabled={loadingId === student.id}
                      className="bg-red-600 text-white px-2 py-1 rounded text-xs hover:bg-red-500"
                    >
                      {loadingId === student.id ? "..." : "Delete"}
                    </button>
                  )}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
        {filteredStudents.length === 0 && <p className="text-center py-4">No students found.</p>}
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\AuthButtons.tsx
--------------------------------------------------

"use client";

import { useSession, signIn, signOut } from "next-auth/react";
import Link from "next/link";

export default function AuthButtons() {
  const { data: session, status } = useSession();

  if (status === "loading") {
    return <p className="text-gray-400 text-sm">Loading...</p>;
  }

  if (session) {
    return (
      <div className="flex items-center gap-6">
        <Link 
          href="/profile" 
          className="text-sm text-indigo-300 hover:text-white transition underline underline-offset-4"
        >
          Edit Profile
        </Link>

        <div className="flex items-center gap-3">
          <div className="text-right hidden sm:block">
            <p className="text-xs text-gray-400">Logged in as</p>
            <p className="text-sm text-white font-medium">
              {session.user?.email?.split('@')[0]}
            </p>
          </div>

          <button
            onClick={() => signOut()}
            className="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-md hover:bg-red-700 transition"
          >
            Log Out
          </button>
        </div>
      </div>
    );
  }

  return (
    <button
      onClick={() => signIn()}
      className="px-4 py-2 text-sm font-medium text-white bg-indigo-600 rounded-md hover:bg-indigo-700 transition"
    >
      Log In
    </button>
  );
}


--------------------------------------------------
FILE: src\components\AuthProvider.tsx
--------------------------------------------------
// src/components/AuthProvider.tsx
"use client";

import { SessionProvider } from "next-auth/react";

export default function AuthProvider({ children }: { children: React.ReactNode }) {
  return <SessionProvider>{children}</SessionProvider>;
}


--------------------------------------------------
FILE: src\components\CompareView.tsx
--------------------------------------------------
// src/components/CompareView.tsx
"use client";

import { useState } from "react";

interface Faculty {
  id: string; name: string; department: string; reviews: { rating: number }[];
}

export default function CompareView({ faculties }: { faculties: Faculty[] }) {
  const [selected1, setSelected1] = useState<string>("");
  const [selected2, setSelected2] = useState<string>("");

  const getFacultyStats = (id: string) => {
    const faculty = faculties.find((f) => f.id === id);
    if (!faculty) return null;
    const totalReviews = faculty.reviews.length;
    const totalRating = faculty.reviews.reduce((sum, r) => sum + r.rating, 0);
    const avgRating = totalReviews > 0 ? (totalRating / totalReviews).toFixed(1) : "N/A";
    return { ...faculty, totalReviews, avgRating };
  };

  const f1 = getFacultyStats(selected1);
  const f2 = getFacultyStats(selected2);

  return (
    <div className="w-full max-w-4xl mx-auto bg-white dark:bg-gray-800 p-8 rounded-xl border border-gray-200 dark:border-gray-700 shadow-xl">
      <h2 className="text-2xl font-bold text-center mb-8 text-transparent bg-clip-text bg-gradient-to-r from-indigo-600 to-cyan-600 dark:from-indigo-400 dark:to-cyan-400">
        Compare Faculty Members
      </h2>

      <div className="grid grid-cols-2 gap-8 mb-8">
        <div>
          <label className="block text-sm text-gray-600 dark:text-gray-400 mb-2">Select Faculty 1</label>
          <select value={selected1} onChange={(e) => setSelected1(e.target.value)} className="w-full p-3 rounded bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white outline-none">
            <option value="">-- Select --</option>
            {faculties.map((f) => (<option key={f.id} value={f.id} disabled={f.id === selected2}>{f.name}</option>))}
          </select>
        </div>
        <div>
          <label className="block text-sm text-gray-600 dark:text-gray-400 mb-2">Select Faculty 2</label>
          <select value={selected2} onChange={(e) => setSelected2(e.target.value)} className="w-full p-3 rounded bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 text-gray-900 dark:text-white outline-none">
            <option value="">-- Select --</option>
            {faculties.map((f) => (<option key={f.id} value={f.id} disabled={f.id === selected1}>{f.name}</option>))}
          </select>
        </div>
      </div>

      {f1 && f2 ? (
        <div className="grid grid-cols-3 gap-4 text-center border-t border-gray-200 dark:border-gray-700 pt-6">
          <div className="flex flex-col gap-6 text-right font-bold text-gray-500 dark:text-gray-400 py-2">
            <div>Name</div><div>Department</div><div>Avg Rating</div><div>Total Reviews</div><div>Rec</div>
          </div>
          <div className="flex flex-col gap-6 bg-gray-50 dark:bg-gray-700/30 rounded-lg py-2 border border-indigo-200 dark:border-indigo-500/30">
            <div className="font-bold text-gray-900 dark:text-white">{f1.name}</div>
            <div className="text-gray-600 dark:text-gray-300">{f1.department}</div>
            <div className="text-yellow-500 dark:text-yellow-400 font-bold text-xl">‚òÖ {f1.avgRating}</div>
            <div className="text-gray-600 dark:text-gray-300">{f1.totalReviews}</div>
            <div className="text-xs text-gray-500">{Number(f1.avgRating) > Number(f2.avgRating) ? "üî• Higher Rated" : "-"}</div>
          </div>
          <div className="flex flex-col gap-6 bg-gray-50 dark:bg-gray-700/30 rounded-lg py-2 border border-cyan-200 dark:border-cyan-500/30">
            <div className="font-bold text-gray-900 dark:text-white">{f2.name}</div>
            <div className="text-gray-600 dark:text-gray-300">{f2.department}</div>
            <div className="text-yellow-500 dark:text-yellow-400 font-bold text-xl">‚òÖ {f2.avgRating}</div>
            <div className="text-gray-600 dark:text-gray-300">{f2.totalReviews}</div>
            <div className="text-xs text-gray-500">{Number(f2.avgRating) > Number(f1.avgRating) ? "üî• Higher Rated" : "-"}</div>
          </div>
        </div>
      ) : <div className="text-center text-gray-500 py-8">Please select two faculty members.</div>}
    </div>
  );
}


--------------------------------------------------
FILE: src\components\ContentProtector.tsx
--------------------------------------------------
"use client";

import { useEffect } from "react";

export default function ContentProtector() {
  useEffect(() => {
    
    const handleContextMenu = (e: MouseEvent) => {
      e.preventDefault();
    };

    
    const handleKeyDown = (e: KeyboardEvent) => {
      
      if (e.key === "F12") {
        e.preventDefault();
      }
      
      
      if (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "i" || e.key === "J" || e.key === "j" || e.key === "C" || e.key === "c")) {
        e.preventDefault();
      }

      
      if (e.ctrlKey && (e.key === "U" || e.key === "u")) {
        e.preventDefault();
      }

      
      if (e.ctrlKey && (e.key === "C" || e.key === "c")) {
        e.preventDefault();
      }
    };

    
    document.addEventListener("contextmenu", handleContextMenu);
    document.addEventListener("keydown", handleKeyDown);

    
    return () => {
      document.removeEventListener("contextmenu", handleContextMenu);
      document.removeEventListener("keydown", handleKeyDown);
    };
  }, []);

  return null; 
}


--------------------------------------------------
FILE: src\components\FacultyRatingChart.tsx
--------------------------------------------------
//src/components ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞‡ßá FacultyRatingChart.tsx
"use client";

import {
  BarChart,
  Bar,
  XAxis,
  YAxis,
  CartesianGrid,
  Tooltip,
  ResponsiveContainer,
  Cell,
} from "recharts";

interface Props {
  reviews: { rating: number }[];
}

export default function FacultyRatingChart({ reviews }: Props) {
  const ratingCounts = { 1: 0, 2: 0, 3: 0, 4: 0, 5: 0 };

  reviews.forEach((review) => {
    // @ts-ignore
    if (ratingCounts[review.rating] !== undefined) {
      // @ts-ignore
      ratingCounts[review.rating] += 1;
    }
  });

  const data = [
    { name: "5 ‚òÖ", count: ratingCounts[5], color: "#22c55e" }, 
    { name: "4 ‚òÖ", count: ratingCounts[4], color: "#84cc16" },
    { name: "3 ‚òÖ", count: ratingCounts[3], color: "#eab308" }, 
    { name: "2 ‚òÖ", count: ratingCounts[2], color: "#f97316" },
    { name: "1 ‚òÖ", count: ratingCounts[1], color: "#ef4444" }, 
  ];

  if (reviews.length === 0) {
    return <p className="text-sm text-gray-500 italic">No rating data available.</p>;
  }

  return (
    <div className="w-full h-64 bg-white dark:bg-gray-800 p-4 rounded-lg shadow border border-gray-200 dark:border-gray-700">
      <h3 className="text-lg font-bold text-gray-800 dark:text-white mb-4">
        üìä Rating Distribution
      </h3>
      
      <ResponsiveContainer width="100%" height="100%">
        <BarChart data={data} layout="vertical" margin={{ top: 5, right: 30, left: 20, bottom: 5 }}>
          <CartesianGrid strokeDasharray="3 3" horizontal={false} stroke="#374151" opacity={0.2} />
          <XAxis type="number" hide />
          <YAxis 
            dataKey="name" 
            type="category" 
            tick={{ fill: '#6b7280', fontSize: 12, fontWeight: 'bold' }} 
            width={30}
          />
          <Tooltip 
            cursor={{ fill: 'transparent' }}
            contentStyle={{ backgroundColor: '#1f2937', borderColor: '#374151', color: '#fff', borderRadius: '8px' }}
            itemStyle={{ color: '#fff' }}
          />
          <Bar dataKey="count" radius={[0, 4, 4, 0]} barSize={20}>
            {data.map((entry, index) => (
              <Cell key={`cell-${index}`} fill={entry.color} />
            ))}
          </Bar>
        </BarChart>
      </ResponsiveContainer>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\FadeIn.tsx
--------------------------------------------------
"use client";

import { motion } from "framer-motion";

interface Props {
  children: React.ReactNode;
  delay?: number; 
  className?: string;
}

export default function FadeIn({ children, delay = 0, className = "" }: Props) {
  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }} 
      whileInView={{ opacity: 1, y: 0 }} 
      viewport={{ once: true }} 
      transition={{ duration: 0.5, delay: delay, ease: "easeOut" }}
      className={className}
    >
      {children}
    </motion.div>
  );
}


--------------------------------------------------
FILE: src\components\FollowButton.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import toast from "react-hot-toast";
import { useRouter } from "next/navigation";

interface Props {
  facultyId: string;
  initialIsFollowing: boolean;
}

export default function FollowButton({ facultyId, initialIsFollowing }: Props) {
  const [isFollowing, setIsFollowing] = useState(initialIsFollowing);
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleFollow = async () => {
    setLoading(true);
    try {
      const res = await fetch("/api/faculty/follow", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ facultyId }),
      });

      if (res.ok) {
        const data = await res.json();
        setIsFollowing(data.isFollowing);
        toast.success(data.isFollowing ? "You are now following! üîî" : "Unfollowed.");
        router.refresh();
      } else {
        toast.error("Need to login first!");
        router.push("/login");
      }
    } catch (error) {
      toast.error("Something went wrong.");
    } finally {
      setLoading(false);
    }
  };

  return (
    <button
      onClick={handleFollow}
      disabled={loading}
      className={`px-4 py-2 rounded-full text-sm font-bold transition flex items-center gap-2 shadow-sm ${
        isFollowing
          ? "bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 border border-gray-300 dark:border-gray-600 hover:bg-red-50 hover:text-red-500 hover:border-red-200"
          : "bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-md"
      }`}
    >
      {loading ? "..." : isFollowing ? "Following ‚úì" : "Follow üîî"}
    </button>
  );
}


--------------------------------------------------
FILE: src\components\Footer.tsx
--------------------------------------------------
import Link from "next/link";

export default function Footer() {
  return (
    <footer className="bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 mt-20">
      <div className="max-w-7xl mx-auto px-4 py-8">
        <div className="flex flex-col md:flex-row justify-between items-center gap-4">
          
          <div className="text-center md:text-left">
            <h2 className="text-xl font-bold text-gray-800 dark:text-white flex items-center gap-2 justify-center md:justify-start">
              <span className="text-2xl">üéì</span> Faculty Review
            </h2>
            <p className="text-sm text-gray-500 mt-1">
              &copy; {new Date().getFullYear()} UIU Faculty Review. Built for students.
            </p>
          </div>

          <div className="flex gap-6 text-sm font-medium text-gray-600 dark:text-gray-400">
            <Link href="/" className="hover:text-indigo-600 dark:hover:text-indigo-400 transition">
              Home
            </Link>
            <Link href="/compare" className="hover:text-indigo-600 dark:hover:text-indigo-400 transition">
              Compare
            </Link>
            <Link href="#" className="hover:text-indigo-600 dark:hover:text-indigo-400 transition">
              About Us
            </Link>
            <Link href="#" className="hover:text-indigo-600 dark:hover:text-indigo-400 transition">
              Privacy Policy
            </Link>
          </div>

        </div>
      </div>
    </footer>
  );
}


--------------------------------------------------
FILE: src\components\Navbar.tsx
--------------------------------------------------
import Link from "next/link";
import { getServerSession } from "next-auth";
import { authOptions } from "@/app/api/auth/[...nextauth]/route";
import NotificationBell from "./NotificationBell";
import ProfileMenu from "./ProfileMenu";
import AuthButtons from "./AuthButtons";

export default async function Navbar() {
  const session = await getServerSession(authOptions);
  
  const userRole = session?.user?.role; 
  const isAdmin = userRole === "admin" || userRole === "ADMIN";

  return (
    <nav className="sticky top-0 z-40 w-full backdrop-blur-lg bg-white/70 dark:bg-gray-900/70 border-b border-gray-200/50 dark:border-gray-800/50 transition-all duration-300">
      <div className="max-w-7xl mx-auto px-4 md:px-8 h-16 flex items-center justify-between">
        
        <Link href="/" className="flex items-center gap-2 group">
          <span className="text-2xl group-hover:scale-110 transition duration-300">üéì</span> 
          <span className="font-extrabold text-xl tracking-tight text-gray-900 dark:text-white">
            Faculty<span className="text-indigo-600 dark:text-indigo-400">Review</span>
          </span>
        </Link>

        <div className="flex items-center gap-4">
          
          {session && <NotificationBell />}

          {session?.user ? (
            <ProfileMenu user={session.user} isAdmin={isAdmin} />
          ) : (
            <AuthButtons />
          )}
        </div>

      </div>
    </nav>
  );
}


--------------------------------------------------
FILE: src\components\NotificationBell.tsx
--------------------------------------------------
"use client";

import { useState, useEffect } from "react";
import { useRouter } from "next/navigation";

interface Notification {
  id: string;
  message: string;
  type: string;
  link?: string;
  isRead: boolean;
  createdAt: string;
}

export default function NotificationBell() {
  const [notifications, setNotifications] = useState<Notification[]>([]);
  const [isOpen, setIsOpen] = useState(false);
  const [unreadCount, setUnreadCount] = useState(0);
  const router = useRouter();

  
  const fetchNotifications = async () => {
    try {
      const res = await fetch("/api/notifications");
      if (res.ok) {
        const data = await res.json();
        setNotifications(data);
        setUnreadCount(data.filter((n: Notification) => !n.isRead).length);
      }
    } catch (error) {
      console.error("Failed to load notifications");
    }
  };

  useEffect(() => {
    fetchNotifications();
    
    const interval = setInterval(fetchNotifications, 30000);
    return () => clearInterval(interval);
  }, []);

  
  const handleNotificationClick = async (notification: Notification) => {
    
    if (!notification.isRead) {
      await fetch("/api/notifications", {
        method: "PATCH",
        body: JSON.stringify({ id: notification.id }),
      });
      
      setNotifications(prev => prev.map(n => n.id === notification.id ? { ...n, isRead: true } : n));
      setUnreadCount(prev => Math.max(0, prev - 1));
    }

    setIsOpen(false);
    
    if (notification.link) {
      router.push(notification.link);
    }
  };

  const markAllAsRead = async () => {
    await fetch("/api/notifications", { method: "PATCH", body: JSON.stringify({}) });
    setNotifications(prev => prev.map(n => ({ ...n, isRead: true })));
    setUnreadCount(0);
  };

  return (
    <div className="relative">
      <button 
        onClick={() => setIsOpen(!isOpen)} 
        className="relative p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition text-gray-600 dark:text-gray-300"
      >
        <span className="text-xl">üîî</span>
        {unreadCount > 0 && (
          <span className="absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full border-2 border-white dark:border-gray-900">
            {unreadCount}
          </span>
        )}
      </button>

      {isOpen && (
        <div className="absolute right-0 mt-2 w-80 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-700 z-50 overflow-hidden">
          <div className="flex justify-between items-center px-4 py-3 border-b border-gray-100 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50">
            <h3 className="font-bold text-sm text-gray-800 dark:text-white">Notifications</h3>
            {unreadCount > 0 && (
              <button onClick={markAllAsRead} className="text-xs text-indigo-600 hover:underline font-medium">
                Mark all read
              </button>
            )}
          </div>

          <div className="max-h-80 overflow-y-auto custom-scrollbar">
            {notifications.length === 0 ? (
              <div className="p-8 text-center text-gray-500 text-sm">
                No notifications yet üîï
              </div>
            ) : (
              notifications.map((notif) => (
                <div 
                  key={notif.id}
                  onClick={() => handleNotificationClick(notif)}
                  className={`px-4 py-3 border-b border-gray-100 dark:border-gray-700 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50 transition ${
                    !notif.isRead ? "bg-indigo-50/50 dark:bg-indigo-900/10 border-l-4 border-l-indigo-500" : ""
                  }`}
                >
                  <p className="text-sm text-gray-800 dark:text-gray-200 leading-snug">
                    {notif.message}
                  </p>
                  <span className="text-[10px] text-gray-400 mt-1 block">
                    {new Date(notif.createdAt).toLocaleDateString()} at {new Date(notif.createdAt).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}
                  </span>
                </div>
              ))
            )}
          </div>
        </div>
      )}

      {isOpen && (
        <div className="fixed inset-0 z-40" onClick={() => setIsOpen(false)}></div>
      )}
    </div>
  );
}


--------------------------------------------------
FILE: src\components\Pagination.tsx
--------------------------------------------------

"use client";

import { useRouter, useSearchParams } from "next/navigation";

interface Props {
  totalItems: number;
  itemsPerPage: number;
  currentPage: number;
}

export default function Pagination({ totalItems, itemsPerPage, currentPage }: Props) {
  const router = useRouter();
  const searchParams = useSearchParams();

  const totalPages = Math.ceil(totalItems / itemsPerPage);

  
  if (totalPages <= 1) return null;

  const handlePageChange = (page: number) => {
    
    const params = new URLSearchParams(searchParams.toString());
    params.set("page", page.toString());
    router.push(`/?${params.toString()}`);
  };

  return (
    <div className="flex justify-center items-center gap-2 mt-8 mb-12">
      <button
        disabled={currentPage === 1}
        onClick={() => handlePageChange(currentPage - 1)}
        className="px-3 py-1 rounded border border-gray-600 text-gray-300 hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Prev
      </button>

      {Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (
        <button
          key={page}
          onClick={() => handlePageChange(page)}
          className={`px-3 py-1 rounded border ${
            currentPage === page
              ? "bg-indigo-600 text-white border-indigo-600"
              : "border-gray-600 text-gray-300 hover:bg-gray-800"
          }`}
        >
          {page}
        </button>
      ))}

      <button
        disabled={currentPage === totalPages}
        onClick={() => handlePageChange(currentPage + 1)}
        className="px-3 py-1 rounded border border-gray-600 text-gray-300 hover:bg-gray-800 disabled:opacity-50 disabled:cursor-not-allowed"
      >
        Next
      </button>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\ProfileEditForm.tsx
--------------------------------------------------
// src/components/ProfileEditForm.tsx
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";

interface Props {
  initialNickname?: string | null;
  initialSemester?: string | null;
}

export default function ProfileEditForm({ initialNickname, initialSemester }: Props) {
  const [nickname, setNickname] = useState(initialNickname || "");
  const [semester, setSemester] = useState(initialSemester || "");
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleUpdate = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const res = await fetch("/api/user/update", {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nickname, semester }),
      });

      if (res.ok) {
        alert("Profile updated successfully!");
        router.refresh();
      } else {
        const data = await res.json();
        alert(data.error || "Something went wrong");
      }
    } catch (error) {
      alert("An error occurred");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="bg-gray-800 p-6 rounded-lg border border-gray-700 h-fit">
      <h2 className="text-xl font-bold mb-4 text-indigo-400">Edit Profile</h2>
      <form onSubmit={handleUpdate} className="space-y-4">
        <div>
          <label className="block text-sm text-gray-400 mb-1">Nickname</label>
          <input
            type="text"
            value={nickname}
            onChange={(e) => setNickname(e.target.value)}
            className="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white focus:border-indigo-500 outline-none"
            placeholder="e.g. DarkKnight_24"
          />
        </div>
        <div>
          <label className="block text-sm text-gray-400 mb-1">Semester</label>
          <input
            type="text"
            value={semester}
            onChange={(e) => setSemester(e.target.value)}
            className="w-full p-2 rounded bg-gray-700 border border-gray-600 text-white focus:border-indigo-500 outline-none"
            placeholder="e.g. 5th Semester"
          />
        </div>
        <button
          type="submit"
          disabled={loading}
          className="w-full bg-indigo-600 py-2 rounded hover:bg-indigo-500 font-medium text-white transition disabled:opacity-50"
        >
          {loading ? "Saving..." : "Update Profile"}
        </button>
      </form>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\ProfileMenu.tsx
--------------------------------------------------
"use client";

import { useState, useRef, useEffect } from "react";
import Link from "next/link";
import { signOut } from "next-auth/react";
import { motion, AnimatePresence } from "framer-motion";
import Image from "next/image";
import { useTheme } from "next-themes"; 

interface Props {
  user: any;
  isAdmin: boolean;
}

export default function ProfileMenu({ user, isAdmin }: Props) {
  const [isOpen, setIsOpen] = useState(false);
  const menuRef = useRef<HTMLDivElement>(null);
  const { theme, setTheme } = useTheme(); 

  // ‡¶Æ‡ßá‡¶®‡ßÅ‡¶∞ ‡¶¨‡¶æ‡¶á‡¶∞‡ßá ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶®‡ßç‡¶ß ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶≤‡¶ú‡¶ø‡¶ï
  useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    }
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const toggleTheme = () => {
    setTheme(theme === "dark" ? "light" : "dark");
  };

  // ‡¶ï‡¶Æ‡¶® ‡¶Æ‡ßá‡¶®‡ßÅ ‡¶Ü‡¶á‡¶ü‡ßá‡¶Æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ (‡¶Ø‡¶æ‡¶§‡ßá ‡¶¨‡¶æ‡¶∞‡¶¨‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶æ‡¶∏ ‡¶≤‡¶ø‡¶ñ‡¶§‡ßá ‡¶®‡¶æ ‡¶π‡ßü)
  const menuItemClass = "flex items-center gap-3 px-4 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-200 hover:bg-indigo-50 dark:hover:bg-gray-800 transition-colors rounded-lg mx-1 my-0.5";

  return (
    <div className="relative" ref={menuRef}>
      
      {/* ‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶® / ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶≠‡¶æ‡¶§‡¶æ‡¶∞ */}
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 focus:outline-none transition transform hover:scale-105 active:scale-95"
      >
        {user?.image ? (
          <Image
            src={user.image}
            alt="Profile"
            width={40}
            height={40}
            className="rounded-full border-2 border-indigo-500 shadow-md object-cover"
          />
        ) : (
          <div className="w-10 h-10 rounded-full bg-gradient-to-tr from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold border-2 border-white/20 shadow-md">
            {user?.name?.charAt(0).toUpperCase() || "U"}
          </div>
        )}
      </button>

      {/* ‡¶°‡ßç‡¶∞‡¶™‡¶°‡¶æ‡¶â‡¶® ‡¶Æ‡ßá‡¶®‡ßÅ */}
      <AnimatePresence>
        {isOpen && (
          <motion.div
            initial={{ opacity: 0, y: 10, scale: 0.95 }}
            animate={{ opacity: 1, y: 0, scale: 1 }}
            exit={{ opacity: 0, y: 10, scale: 0.95 }}
            transition={{ duration: 0.2 }}
            className="absolute right-0 mt-3 w-64 bg-white dark:bg-gray-900 rounded-xl shadow-2xl border border-gray-200 dark:border-gray-800 overflow-hidden z-50 origin-top-right ring-1 ring-black ring-opacity-5"
          >
            
            {/* ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶ì ‡¶á‡¶Æ‡ßá‡¶á‡¶≤ */}
            <div className="px-5 py-4 border-b border-gray-100 dark:border-gray-800 bg-gray-50/50 dark:bg-gray-800/50">
              <p className="text-sm font-bold text-gray-900 dark:text-white truncate">
                {user?.name || "User"}
              </p>
              <p className="text-xs text-gray-500 dark:text-gray-400 truncate mt-0.5">
                {user?.email}
              </p>
            </div>

            <div className="py-2 flex flex-col">
              
              {/* ‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¶‡ßÉ‡¶∂‡ßç‡¶Ø‡¶Æ‡¶æ‡¶® */}
              <Link href="/compare" onClick={() => setIsOpen(false)} className={menuItemClass}>
                <span className="text-lg">‚öñÔ∏è</span> Compare Faculty
              </Link>

              <Link href="/profile" onClick={() => setIsOpen(false)} className={menuItemClass}>
                <span className="text-lg">‚úèÔ∏è</span> Edit Profile
              </Link>
              {isAdmin && (
                <Link href="/admin" onClick={() => setIsOpen(false)} className={`${menuItemClass} text-indigo-600 dark:text-indigo-400 bg-indigo-50/50 dark:bg-indigo-900/20 border border-indigo-100 dark:border-indigo-800`}>
                  <span className="text-lg">üõ°Ô∏è</span> Admin Dashboard
                </Link>
              )}

              {/* ‡¶•‡¶ø‡¶Æ ‡¶ü‡¶ó‡¶≤ ‡¶¨‡¶æ‡¶ü‡¶® */}
              <button onClick={toggleTheme} className={`${menuItemClass} justify-between w-full`}>
                <span className="flex items-center gap-3">
                  <span className="text-lg">{theme === 'dark' ? 'üåô' : '‚òÄÔ∏è'}</span> 
                  {theme === 'dark' ? 'Light Mode' : 'Dark Mode'}
                </span>
                {/* ‡¶ü‡¶ó‡¶≤ ‡¶∏‡ßÅ‡¶á‡¶ö ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® */}
                <div className={`w-9 h-5 flex items-center bg-gray-300 dark:bg-gray-600 rounded-full p-1 duration-300 ${theme === 'dark' ? 'bg-indigo-500' : ''}`}>
                  <div className={`bg-white w-3.5 h-3.5 rounded-full shadow-md transform duration-300 ${theme === 'dark' ? 'translate-x-4' : ''}`}></div>
                </div>
              </button>

              <div className="h-px bg-gray-100 dark:bg-gray-800 my-1 mx-2"></div>

              {/* ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶¨‡¶æ‡¶ü‡¶® */}
              <button 
                onClick={() => signOut()} 
                className={`${menuItemClass} text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20`}
              >
                <span className="text-lg">üö™</span> Log Out
              </button>
            </div>

          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\QASection.tsx
--------------------------------------------------

"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";

interface User {
  id: string;
  nickname: string | null;
  semester: string | null;
}

interface Answer {
  id: string;
  content: string;
  createdAt: Date;
  user: User;
}

interface Question {
  id: string;
  content: string;
  createdAt: Date;
  user: User;
  answers: Answer[];
}

export default function QASection({ facultyId, questions, session }: { facultyId: string, questions: Question[], session: any }) {
  const [isOpen, setIsOpen] = useState(false); 
  const [newQuestion, setNewQuestion] = useState("");
  const [replyText, setReplyText] = useState<{ [key: string]: string }>({}); 
  const [replyOpen, setReplyOpen] = useState<{ [key: string]: boolean }>({}); 
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  
  const handlePostQuestion = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!newQuestion.trim()) return;
    setLoading(true);
    await fetch("/api/qa/question", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ facultyId, content: newQuestion }),
    });
    setNewQuestion("");
    setLoading(false);
    router.refresh();
  };

  
  const handlePostAnswer = async (questionId: string) => {
    if (!replyText[questionId]?.trim()) return;
    setLoading(true);
    await fetch("/api/qa/answer", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ questionId, content: replyText[questionId] }),
    });
    setReplyText({ ...replyText, [questionId]: "" });
    setReplyOpen({ ...replyOpen, [questionId]: false });
    setLoading(false);
    router.refresh();
  };

  return (
    <div className="mt-4 border-t border-gray-700 pt-4">
      <button 
        onClick={() => setIsOpen(!isOpen)}
        className="text-indigo-400 text-sm font-bold hover:underline flex items-center gap-2"
      >
        üí¨ Q/A Section ({questions.length}) {isOpen ? "‚ñ≤" : "‚ñº"}
      </button>

      {isOpen && (
        <div className="mt-4 space-y-6 bg-gray-900/50 p-4 rounded-lg">
          
          {/* ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶∞‡ßç‡¶Æ */}
          {session ? (
            <form onSubmit={handlePostQuestion} className="flex gap-2 mb-6">
              <input
                type="text"
                value={newQuestion}
                onChange={(e) => setNewQuestion(e.target.value)}
                placeholder="Ask an anonymous question..."
                className="flex-1 bg-gray-800 border border-gray-600 rounded p-2 text-sm text-white"
              />
              <button 
                type="submit" 
                disabled={loading}
                className="bg-indigo-600 px-3 py-2 rounded text-sm text-white hover:bg-indigo-500"
              >
                Ask
              </button>
            </form>
          ) : (
            <p className="text-gray-500 text-sm mb-4">Login to ask questions.</p>
          )}

          {/* ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ */}
          <div className="space-y-4">
            {questions.map((q) => (
              <div key={q.id} className="bg-gray-800 p-3 rounded border border-gray-700">
                <div className="flex justify-between items-start">
                  <p className="text-white font-medium text-sm">‚ùì {q.content}</p>
                  <Link href={`/student/${q.user.id}`} className="text-xs text-gray-400 hover:text-indigo-400">
                    @{q.user.nickname || "Anon"}
                  </Link>
                </div>

                {/* ‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶∏‡¶Æ‡ßÇ‡¶π */}
                <div className="mt-2 ml-4 space-y-2 border-l-2 border-gray-600 pl-3">
                  {q.answers.map((ans) => (
                    <div key={ans.id} className="bg-gray-700/30 p-2 rounded text-xs">
                      <div className="flex justify-between">
                        <span className="text-gray-300">{ans.content}</span>
                        <Link href={`/student/${ans.user.id}`} className="text-gray-500 hover:text-indigo-300">
                          - @{ans.user.nickname || "Anon"}
                        </Link>
                      </div>
                    </div>
                  ))}
                </div>

                {/* ‡¶â‡¶§‡ßç‡¶§‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ö‡¶™‡¶∂‡¶® */}
                {session && (
                  <div className="mt-2">
                    {!replyOpen[q.id] ? (
                      <button 
                        onClick={() => setReplyOpen({ ...replyOpen, [q.id]: true })}
                        className="text-xs text-indigo-400 hover:underline ml-4"
                      >
                        Reply
                      </button>
                    ) : (
                      <div className="flex gap-2 mt-2 ml-4">
                        <input
                          type="text"
                          value={replyText[q.id] || ""}
                          onChange={(e) => setReplyText({ ...replyText, [q.id]: e.target.value })}
                          placeholder="Write a reply..."
                          className="flex-1 bg-gray-700 border border-gray-600 rounded p-1 text-xs text-white"
                        />
                        <button 
                          onClick={() => handlePostAnswer(q.id)}
                          className="bg-green-600 px-2 py-1 rounded text-xs text-white"
                        >
                          Reply
                        </button>
                        <button 
                          onClick={() => setReplyOpen({ ...replyOpen, [q.id]: false })}
                          className="text-gray-400 text-xs"
                        >
                          Cancel
                        </button>
                      </div>
                    )}
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      )}
    </div>
  );
}


--------------------------------------------------
FILE: src\components\ReportButton.tsx
--------------------------------------------------
// src/components/ReportButton.tsx
"use client";

import { useState } from "react";
import toast from "react-hot-toast";

export default function ReportButton({ reviewId }: { reviewId: string }) {
  const [loading, setLoading] = useState(false);

  const handleReport = async () => {
    if (!confirm("Are you sure you want to report this review as inappropriate?")) return;
    
    setLoading(true);
    const res = await fetch("/api/report", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ reviewId, reason: "Inappropriate Content" }),
    });

    setLoading(false);
    if (res.ok) {
      toast.success("Report submitted! Admin will review it.");
    } else {
      toast.error("Failed to report. Try again.");
    }
  };

  return (
    <button 
      onClick={handleReport} 
      disabled={loading}
      className="text-[10px] text-gray-500 hover:text-red-400 flex items-center gap-1 mt-2"
    >
      üö© Report
    </button>
  );
}


--------------------------------------------------
FILE: src\components\ReviewForm.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import toast from "react-hot-toast";

interface Props {
  facultyId: string;
}

export default function ReviewForm({ facultyId }: Props) {
  
  const [rating, setRating] = useState(0);
  const [course, setCourse] = useState("");
  const [comment, setComment] = useState("");
  const [loading, setLoading] = useState(false);
  const router = useRouter();

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (rating === 0) {
      toast.error("Please give a rating ‚≠ê");
      return;
    }
    
    setLoading(true);

    try {
      const res = await fetch("/api/review", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ facultyId, rating, course, comment }),
      });

      if (res.ok) {
        toast.success("Review submitted for approval! üéâ");
        setRating(0);
        setCourse("");
        setComment("");
        router.refresh();
        
        
      } else {
        const errorData = await res.json();
        toast.error(errorData.error || "Failed to submit.");
      }
    } catch (error) {
      toast.error("Something went wrong.");
    } finally {
      setLoading(false);
    }
  };

  return (
    
    <form onSubmit={handleSubmit} className="space-y-4">
      
      <div>
        <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-1">
          Rating
        </label>
        <div className="flex gap-2">
          {[1, 2, 3, 4, 5].map((star) => (
            <button
              key={star}
              type="button"
              onClick={() => setRating(star)}
              className={`text-2xl transition transform hover:scale-110 ${
                star <= rating ? "text-yellow-400" : "text-gray-300 dark:text-gray-600"
              }`}
            >
              ‚òÖ
            </button>
          ))}
        </div>
      </div>

      <div>
        <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-1">
          Course Taken (e.g. CSE101)
        </label>
        <input
          type="text"
          value={course}
          onChange={(e) => setCourse(e.target.value)}
          placeholder="Enter course code"
          className="w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 focus:border-indigo-500 outline-none transition"
          required
        />
      </div>

      <div>
        <label className="block text-sm font-bold text-gray-700 dark:text-gray-300 mb-1">
          Review
        </label>
        <textarea
          value={comment}
          onChange={(e) => setComment(e.target.value)}
          placeholder="Share your honest experience..."
          rows={4}
          className="w-full p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 focus:border-indigo-500 outline-none transition"
          required
        />
      </div>

      <button
        type="submit"
        disabled={loading}
        className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-lg transition shadow-lg hover:shadow-indigo-500/30 disabled:opacity-50"
      >
        {loading ? "Submitting..." : "Submit Review"}
      </button>

    </form>
  );
}


--------------------------------------------------
FILE: src\components\ReviewModalButton.tsx
--------------------------------------------------
"use client";

import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";
import ReviewForm from "./ReviewForm";

interface Props {
  facultyId: string;
}

export default function ReviewModalButton({ facultyId }: Props) {
  const [isOpen, setIsOpen] = useState(false);

  return (
    <>
      <button
        onClick={() => setIsOpen(true)}
        className="w-full mt-4 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-300 font-bold py-2.5 rounded-xl hover:bg-indigo-600 hover:text-white dark:hover:bg-indigo-500 transition-all duration-300 shadow-sm hover:shadow-md flex items-center justify-center gap-2"
      >
        <span>‚úçÔ∏è</span> Write a Review
      </button>

      <AnimatePresence>
        {isOpen && (
          <div className="fixed inset-0 z-[100] flex items-center justify-center px-4">
            
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              exit={{ opacity: 0 }}
              onClick={() => setIsOpen(false)} 
              className="absolute inset-0 bg-black/60 backdrop-blur-sm"
            />

            <motion.div
              initial={{ scale: 0.9, opacity: 0, y: 20 }}
              animate={{ scale: 1, opacity: 1, y: 0 }}
              exit={{ scale: 0.9, opacity: 0, y: 20 }}
              className="relative w-full max-w-lg bg-white dark:bg-gray-900 rounded-2xl shadow-2xl overflow-hidden border border-gray-200 dark:border-gray-700"
            >
              
              <div className="flex justify-between items-center p-5 border-b border-gray-100 dark:border-gray-800 bg-gray-50 dark:bg-gray-800/50">
                <h3 className="text-lg font-bold text-gray-800 dark:text-white">
                  Submit Your Review
                </h3>
                <button
                  onClick={() => setIsOpen(false)}
                  className="w-8 h-8 flex items-center justify-center rounded-full bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-red-500 hover:text-white transition"
                >
                  ‚úï
                </button>
              </div>

              <div className="p-6">
                 
                 <ReviewForm facultyId={facultyId} />
              </div>

            </motion.div>
          </div>
        )}
      </AnimatePresence>
    </>
  );
}


--------------------------------------------------
FILE: src\components\SearchBox.tsx
--------------------------------------------------
//src/components/SearchBox.tsx
"use client";

import { useRouter, useSearchParams, usePathname } from "next/navigation";
import { useState, useEffect } from "react";

export default function SearchBox() {
  const searchParams = useSearchParams();
  const pathname = usePathname();
  const { replace } = useRouter();
  
  const [term, setTerm] = useState(searchParams.get("q")?.toString() || "");

  useEffect(() => {
    const delayDebounceFn = setTimeout(() => {
      const params = new URLSearchParams(searchParams);
      
      if (term) {
        params.set("q", term);
      } else {
        params.delete("q"); 
      }

      replace(`${pathname}?${params.toString()}`, { scroll: false });
    }, 300);

    return () => clearTimeout(delayDebounceFn);
  }, [term, pathname, replace, searchParams]);

  return (
    <div className="relative w-full max-w-2xl mx-auto group">
      <div className="absolute -inset-1 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-2xl blur opacity-30 group-hover:opacity-70 transition duration-500"></div>
      
      <div className="relative flex bg-white dark:bg-gray-800 rounded-xl overflow-hidden shadow-2xl p-1">
        <div className="pl-4 flex items-center pointer-events-none">
          <svg className="w-5 h-5 text-gray-500 dark:text-gray-400" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20">
            <path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"/>
          </svg>
        </div>

        <input
          type="text"
          value={term}
          onChange={(e) => setTerm(e.target.value)}
          placeholder="Search by Name or Dept..."
          className="flex-1 p-4 text-gray-900 dark:text-white dark:bg-gray-800 outline-none placeholder-gray-500 dark:placeholder-gray-400 text-lg bg-transparent"
        />

        {term && (
          <button 
            onClick={() => setTerm("")}
            className="pr-4 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200"
          >
            ‚úï
          </button>
        )}
      </div>
    </div>
  );
}


--------------------------------------------------
FILE: src\components\SessionGuard.tsx
--------------------------------------------------
"use client";

import { useSession, signOut } from "next-auth/react";
import { useEffect, useRef } from "react";
import toast from "react-hot-toast";

export default function SessionGuard() {
  const { data: session } = useSession();
  const toastShown = useRef(false); 

  useEffect(() => {
    // @ts-ignore
    if (session?.error === "UserDeleted" && !toastShown.current) {
      toastShown.current = true;

      toast.error("Your account has been deleted. Logging out...", {
        duration: 4000,
        style: {
          border: '1px solid #ef4444',
          padding: '16px',
          color: '#ef4444',
          background: '#fff',
        },
        iconTheme: {
          primary: '#ef4444',
          secondary: '#FFFAEE',
        },
      });

      const timer = setTimeout(() => {
        signOut({ callbackUrl: "/login" }); 
      }, 2000);

      return () => clearTimeout(timer);
    }
  }, [session]);

  return null;
}


--------------------------------------------------
FILE: src\components\ThemeSwitcher.tsx
--------------------------------------------------
// src/components/ThemeSwitcher.tsx
"use client";

import { useState, useEffect } from "react";
import { useTheme } from "next-themes";

export default function ThemeSwitcher() {
  const [mounted, setMounted] = useState(false);
  const { theme, setTheme } = useTheme();

  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) return null;

  return (
    <button
      onClick={() => setTheme(theme === "dark" ? "light" : "dark")}
      className="fixed bottom-5 right-5 z-50 p-3 rounded-full shadow-xl border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 text-xl transition-transform hover:scale-110"
      title="Toggle Theme"
    >
      {theme === "dark" ? "‚òÄÔ∏è" : "üåô"}
    </button>
  );
}


--------------------------------------------------
FILE: src\components\UserBadge.tsx
--------------------------------------------------
"use client";

interface Props {
  reviewCount: number;
  role?: string;
}

export default function UserBadge({ reviewCount, role }: Props) {
  
  if (role === "ADMIN") {
    return (
      <span className="bg-red-100 text-red-700 border border-red-200 text-xs px-2 py-1 rounded-full font-bold flex items-center gap-1">
        üõ°Ô∏è Admin
      </span>
    );
  }

  
  if (reviewCount >= 10) {
    return (
      <span className="bg-yellow-100 text-yellow-800 border border-yellow-300 text-xs px-2 py-1 rounded-full font-bold flex items-center gap-1 shadow-sm">
        ü•á Master Critic
      </span>
    );
  } 
  
  if (reviewCount >= 5) {
    return (
      <span className="bg-gray-100 text-gray-700 border border-gray-300 text-xs px-2 py-1 rounded-full font-bold flex items-center gap-1 shadow-sm">
        ü•à Pro Reviewer
      </span>
    );
  } 
  
  if (reviewCount >= 1) {
    return (
      <span className="bg-orange-50 text-orange-700 border border-orange-200 text-xs px-2 py-1 rounded-full font-bold flex items-center gap-1">
        ü•â Contributor
      </span>
    );
  }

  
  return (
    <span className="bg-slate-100 text-slate-500 text-xs px-2 py-1 rounded-full font-medium">
      üê£ Newbie
    </span>
  );
}


--------------------------------------------------
FILE: src\components\VoteButtons.tsx
--------------------------------------------------

"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";

interface VoteProps {
  reviewId: string;
  initialVotes: any[]; 
  currentUserId?: string; 
}

export default function VoteButtons({ reviewId, initialVotes, currentUserId }: VoteProps) {
  const router = useRouter();
  
  
  const upvotes = initialVotes.filter((v) => v.type === "UP").length;
  const downvotes = initialVotes.filter((v) => v.type === "DOWN").length;
  
  
  const myVote = initialVotes.find((v) => v.userId === currentUserId)?.type;

  const [loading, setLoading] = useState(false);

  const handleVote = async (type: "UP" | "DOWN") => {
    if (!currentUserId) {
      alert("Please login to vote!");
      return;
    }
    setLoading(true);

    await fetch("/api/vote", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ reviewId, type }),
    });

    setLoading(false);
    router.refresh(); 
  };

  return (
    <div className="flex items-center gap-2 mt-2">
      <button
        onClick={() => handleVote("UP")}
        disabled={loading}
        className={`flex items-center gap-1 px-2 py-1 rounded text-xs font-bold transition ${
          myVote === "UP" 
            ? "bg-green-600 text-white" 
            : "bg-gray-700 text-gray-400 hover:bg-gray-600"
        }`}
      >
        üëç {upvotes}
      </button>

      <button
        onClick={() => handleVote("DOWN")}
        disabled={loading}
        className={`flex items-center gap-1 px-2 py-1 rounded text-xs font-bold transition ${
          myVote === "DOWN" 
            ? "bg-red-600 text-white" 
            : "bg-gray-700 text-gray-400 hover:bg-gray-600"
        }`}
      >
        üëé {downvotes}
      </button>
    </div>
  );
}


--------------------------------------------------
FILE: src\lib\email.ts
--------------------------------------------------
// src/lib/email.ts
import nodemailer from "nodemailer";

const transporter = nodemailer.createTransport({
  host: process.env.EMAIL_SERVER_HOST,
  port: Number(process.env.EMAIL_SERVER_PORT),
  auth: {
    user: process.env.EMAIL_SERVER_USER,
    pass: process.env.EMAIL_SERVER_PASSWORD,
  },
});

export const sendVerificationEmail = async (email: string, token: string) => {
  const baseUrl = process.env.NEXT_PUBLIC_FRONTEND_URL || process.env.NEXTAUTH_URL || "http://localhost:3000";
  const confirmLink = `${baseUrl}/verify-email?token=${token}`;

  await transporter.sendMail({
    from: process.env.EMAIL_FROM,
    to: email,
    subject: "Verify your Faculty Review Account",
    html: `
      <div style="font-family: Arial, sans-serif; padding: 20px; color: #333;">
        <h2 style="color: #4F46E5;">Welcome to Faculty Review!</h2>
        <p>Thanks for signing up. Please click the link below to verify your university email address:</p>
        
        <div style="margin: 20px 0;">
          <a href="${confirmLink}" style="background-color: #4F46E5; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; font-weight: bold;">Verify Email</a>
        </div>
        
        <p>Or copy and paste this link in your browser:</p>
        <p><a href="${confirmLink}">${confirmLink}</a></p>
        
        <p style="color: #666; font-size: 12px; margin-top: 30px;">
           For security reasons, this link will expire in <strong>15 minutes</strong>.
        </p>
      </div>
    `,
  });
};

export const sendPasswordResetEmail = async (email: string, token: string) => {
  const baseUrl = process.env.NEXT_PUBLIC_FRONTEND_URL || process.env.NEXTAUTH_URL || "http://localhost:3000";
  const resetLink = `${baseUrl}/reset-password?token=${token}`;

  await transporter.sendMail({
    from: process.env.EMAIL_FROM,
    to: email,
    subject: "Reset your Password - Faculty Review",
    html: `
      <div style="font-family: Arial, sans-serif; padding: 20px; color: #333;">
        <h2 style="color: #4F46E5;">Password Reset Request</h2>
        <p>Someone requested a password reset for your account. If this was you, click the link below to set a new password:</p>
        
        <div style="margin: 20px 0;">
          <a href="${resetLink}" style="background-color: #EF4444; color: white; padding: 12px 24px; text-decoration: none; border-radius: 5px; font-weight: bold;">Reset Password</a>
        </div>
        
        <p>Or copy this link:</p>
        <p><a href="${resetLink}">${resetLink}</a></p>
        
        <p style="color: #666; font-size: 12px; margin-top: 30px;">This link will expire in 1 hour. If you didn't ask for this, simply ignore this email.</p>
      </div>
    `,
  });
};


--------------------------------------------------
FILE: src\lib\prisma.ts
--------------------------------------------------
import { PrismaClient } from "@prisma/client";

const prismaClientSingleton = () => {
  return new PrismaClient();
};

declare global {
  var prisma: undefined | ReturnType<typeof prismaClientSingleton>;
}

const prisma = globalThis.prisma ?? prismaClientSingleton();

export default prisma;

if (process.env.NODE_ENV !== "production") globalThis.prisma = prisma;


--------------------------------------------------
FILE: src\middleware.ts
--------------------------------------------------
import { NextResponse } from "next/server";
import type { NextRequest } from "next/server";
import { getToken } from "next-auth/jwt";


const ratelimit = new Map();

function checkRateLimit(ip: string) {
  const windowMs = 60 * 1000;
  const maxReq = 60;
  const now = Date.now();
  const record = ratelimit.get(ip);


  if (!record) {
    ratelimit.set(ip, { count: 1, startTime: now });
    return true;
  }

  if (now - record.startTime > windowMs) {
    ratelimit.set(ip, { count: 1, startTime: now });
    return true;
  }

  if (record.count >= maxReq) return false;
  record.count += 1;
  return true;
}



export async function middleware(request: NextRequest) {
  const ip = request.headers.get("x-forwarded-for") ?? "127.0.0.1";

  if (!checkRateLimit(ip)) {
    return new NextResponse("Too Many Requests. Please slow down.", { status: 429 });
  }

  const token = await getToken({ req: request });
  const { pathname } = request.nextUrl;

  const isPublicPath =
    pathname === "/login" ||
    pathname === "/register" ||
    pathname === "/forgot-password" ||  
    pathname === "/reset-password" ||  
    pathname.startsWith("/verify-email") ||
    pathname.startsWith("/api/auth") ||    
    pathname === "/api/register" ||
    pathname === "/auth-error";

  if (!token && !isPublicPath) {
    return NextResponse.redirect(new URL("/login", request.url));
  }
  if (token && (pathname === "/login" || pathname === "/register" || pathname === "/forgot-password")) {
    return NextResponse.redirect(new URL("/", request.url));
  }

  if (pathname.startsWith("/admin")) {

    if (token?.role !== "ADMIN" && token?.role !== "admin" ) {
      return NextResponse.redirect(new URL("/", request.url));
    }
  }

  return NextResponse.next();
}

export const config = {

  matcher: ["/((?!_next/static|_next/image|favicon.ico).*)"],

}; 


--------------------------------------------------
FILE: src\providers\ThemeProvider.tsx
--------------------------------------------------
// src/providers/ThemeProvider.tsx
"use client";

import { ThemeProvider as NextThemesProvider } from "next-themes";
import { type ComponentProps } from "react";

export function ThemeProvider({ children, ...props }: ComponentProps<typeof NextThemesProvider>) {
  return <NextThemesProvider {...props}>{children}</NextThemesProvider>;
}


--------------------------------------------------
FILE: src\types\next-auth.d.ts
--------------------------------------------------
// src/types/next-auth.d.ts
import { DefaultSession } from "next-auth";

declare module "next-auth" {
  /**
   * Returned by `useSession`, `getSession` and received as a prop on the `SessionProvider` React Context
   */
  interface Session {
    user: {
      id: string;
      nickname?: string | null;
      role?: string;
      semester?: string | null;
      studentId?: string | null;
    } & DefaultSession["user"];
  }

  interface User {
    id: string;
    nickname?: string | null;
    role?: string;
    semester?: string | null;
    studentId?: string | null;
  }
}

declare module "next-auth/jwt" {
  interface JWT {
    id: string;
    role?: string;
    nickname?: string | null;
    studentId?: string | null;
    semester?: string | null;
  }
}


--------------------------------------------------
FILE: src\types.ts
--------------------------------------------------
// src/types.ts
export type ReportedReview = {
  id: string;
  reason: string;
  reviewId: string;
  user: {
    nickname: string | null;
  };
  review: {
    id: string;
    user: { nickname: string | null };
    faculty: { name: string };
    comment: string;
    rating: number;
  };
};



--------------------------------------------------
FILE: tailwind.config.ts
--------------------------------------------------

import type { Config } from "tailwindcss";

const config: Config = {
  darkMode: 'class',
  content: [
    "./src/pages/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/components/**/*.{js,ts,jsx,tsx,mdx}",
    "./src/app/**/*.{js,ts,jsx,tsx,mdx}",
  ],
  theme: {
    extend: {
      fontFamily: {
        
        sans: ["var(--font-inter)", "sans-serif"],
        display: ["var(--font-jakarta)", "sans-serif"],
      },
      backgroundImage: {
        "gradient-radial": "radial-gradient(var(--tw-gradient-stops))",
        "gradient-conic":
          "conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))",
      },
      animation: {
        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
      },
    },
  },
  plugins: [],
};
export default config;


--------------------------------------------------
FILE: tsconfig.json
--------------------------------------------------
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}


